<!DOCTYPE html><html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="title" content="Posts about CMake | Corleonis">
    <meta name="description" content="I am Swind.">
    <meta name="author" content="Swind">
    <title>Posts about CMake | Corleonis</title>
    <!-- Le styles -->
        <link href="../assets/css/bootstrap.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/monokai.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/slides.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/bootstrap-responsive.css" rel="stylesheet" type="text/css">
        <script src="../assets/js/jquery-1.7.2.min.js" type="text/javascript"></script>
        <script src="../assets/js/jquery.colorbox-min.js" type="text/javascript"></script>
        <script src="../assets/js/slides.min.jquery.js" type="text/javascript"></script>
        <script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
        <link rel="alternate" type="application/rss+xml" title="RSS for tag CMake (en)" href="cmake.xml">

    
    
</head>
<body>
<!-- Menubar -->
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>        
        
            <a class="brand" href="../">
            Corleonis
            </a>
            <!-- Everything you want hidden at 940px or less, place within here -->
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
            <li><a href="../archive.html">Archives</a>
            </li><li><a href="index.html">Tags</a>
            </li><li><a href="../stories/linux-note.html">Linux 筆記</a>

                </li></ul>
                <ul class="nav pull-right">
                
                
                 
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End of Menubar -->
<div class="container-fluid" id="container-fluid">
    <!--Body content-->
    <div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
    
        <div class="postbox">
        <h1><a href="../posts/cmake-add_custom_command.html">CMake - add_custom_command</a>
        <small>  
             Posted: 2013-06-25 19:20
        </small></h1>
        <hr>
        <p>最近因為必須要示範如何將公司的 autoconf 與 automake 轉成 CMake，所以稍微研究了一下之前完全沒有用過得 <a class="reference external" href="http://www.cmake.org/cmake/help/cmake2.6docs.html#command:add_custom_command">add_custom_command</a> 跟 <a class="reference external" href="http://www.cmake.org/cmake/help/cmake2.6docs.html#command:add_custom_target">add_custom_target</a></p>
<div class="section" id="symbolic-link">
<h2>建立 symbolic link</h2>
<p>目前有一個需求是要建立 symbolic link 在某些特定的資料夾裡面。
由於 autotools 是可以直接使用 script 的語法，所以建立起來非常簡單。</p>
<pre class="code bash literal-block">
install-exec-hook:
     ln -fs <span class="k">$(</span>source_prefix<span class="k">)</span>/a <span class="k">$(</span>target_prefix<span class="k">)</span>/path1
     ln -fs <span class="k">$(</span>source_prefix<span class="k">)</span>/a <span class="k">$(</span>target_prefix<span class="k">)</span>/path2
     ln -fs <span class="k">$(</span>source_prefix<span class="k">)</span>/a <span class="k">$(</span>target_prefix<span class="k">)</span>/path3
     ln -fs <span class="k">$(</span>source_prefix<span class="k">)</span>/a <span class="k">$(</span>target_prefix<span class="k">)</span>/path4
     ln -fs <span class="k">$(</span>source_prefix<span class="k">)</span>/a <span class="k">$(</span>target_prefix<span class="k">)</span>/path5
</pre>
<p>這樣只要直接呼叫 make install-exec-hook 就可以建立 symbolic link 了。
但是如果要在 CMake 裡面作到一樣的事情要怎麼處理呢？</p>
<pre class="code cmake literal-block">
<span class="nb">Set</span><span class="p">(</span><span class="s">targets</span>
    <span class="o">${</span><span class="nv">target_prefix</span><span class="o">}</span><span class="s">/path1</span>
    <span class="o">${</span><span class="nv">target_prefix</span><span class="o">}</span><span class="s">/path2</span>
    <span class="o">${</span><span class="nv">target_prefix</span><span class="o">}</span><span class="s">/path3</span>
    <span class="o">${</span><span class="nv">target_prefix</span><span class="o">}</span><span class="s">/path4</span>
    <span class="o">${</span><span class="nv">target_prefix</span><span class="o">}</span><span class="s">/path5</span>
<span class="p">)</span>

<span class="nb">Function</span><span class="p">(</span><span class="s">Create_symbolic_link</span> <span class="s">source</span> <span class="s">target</span><span class="p">)</span>
    <span class="nb">Add_custom_command</span><span class="p">(</span>
        <span class="s">OUTPUT</span> <span class="o">${</span><span class="nv">target</span><span class="o">}</span>
        <span class="s">COMMAND</span> <span class="s">ln</span> <span class="s">-fs</span> <span class="o">${</span><span class="nv">source</span><span class="o">}</span> <span class="o">${</span><span class="nv">target</span><span class="o">}</span>
    <span class="p">)</span>
<span class="nb">Endfunction</span><span class="p">()</span>

<span class="nb">Foreach</span><span class="p">(</span><span class="s">target</span> <span class="s">targets</span><span class="p">)</span>
   <span class="nb">Create_symbolic_link</span><span class="p">(</span><span class="o">${</span><span class="nv">source_prefix</span><span class="o">}</span><span class="s">/a</span> <span class="o">${</span><span class="nv">target</span><span class="o">}</span><span class="p">)</span>
<span class="nb">Endforeach</span><span class="p">()</span>

<span class="nb">Add_custom_target</span><span class="p">(</span><span class="s">install-exec-hook</span> <span class="s">DEPENDS</span> <span class="o">${</span><span class="nv">targets</span><span class="o">}</span><span class="p">)</span>
</pre>
<p>因為 CMake 裡面沒有辦法像 shell script 一樣直接下指令，必須透過 Add_custom_command 或者是 Execute_process 等方式執行。
但是若又要跟 Target 建立相依性的話，似乎就一定得靠 Add_custom_command，因為他會設定一個 output file。
這樣就可以讓 Target 依賴這個檔案 ( 以我們的例子來說 Target 就是 install-exec-hook ) 來達到 make Target 就可以建立 symbolic link 的目的。</p>
<p>閃死人不償命的組合 ...</p>
<div class="figure">
<img alt="https://dl.dropboxusercontent.com/u/15537823/Blog/banner-of-the-stars_2.jpg" src="https://dl.dropboxusercontent.com/u/15537823/Blog/banner-of-the-stars_2.jpg">
</div>
<blockquote>
<p>星たちよ</p>
<p>汝の命短き眷族の望みを聞くがよい。</p>
<p>我らの望みヽ</p>
<p>それは</p>
<p>汝の本降ちゆくを看取ること</p>
</blockquote></div>
        
    <p>
        <a href="../posts/cmake-add_custom_command.html#disqus_thread" data-disqus-identifier="cache/posts/2013-06-25-cmake-add-custom-command.html">Comments</a>

        </p></div>
    
<div>
<ul class="pager">
</ul>
</div>

    
       <script type="text/javascript">var disqus_shortname="swindgithub";(function(){var a=document.createElement("script");a.async=true;a.type="text/javascript";a.src="http://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)}());</script>


    </div>
    </div> 
    <!--End of body content-->
</div>

<div class="footerbox">
    Contents © 2013 <a href="mailto:">Swind</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
</div>

    
    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"80%",maxHeight:"80%",scalePhotos:true});</script>

</body>
</html>