<!DOCTYPE html><html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="title" content="Posts about Akka | Corleonis">
    <meta name="description" content="I am Swind.">
    <meta name="author" content="Swind">
    <title>Posts about Akka | Corleonis</title>
    <!-- Le styles -->
        <link href="../assets/css/bootstrap.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/monokai.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/slides.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/bootstrap-responsive.css" rel="stylesheet" type="text/css">
        <script src="../assets/js/jquery-1.7.2.min.js" type="text/javascript"></script>
        <script src="../assets/js/jquery.colorbox-min.js" type="text/javascript"></script>
        <script src="../assets/js/slides.min.jquery.js" type="text/javascript"></script>
        <script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
        <link rel="alternate" type="application/rss+xml" title="RSS for tag Akka (en)" href="akka.xml">

    
    
</head>
<body>
<!-- Menubar -->
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>        
        
            <a class="brand" href="../">
            Corleonis
            </a>
            <!-- Everything you want hidden at 940px or less, place within here -->
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
            <li><a href="../archive.html">Archives</a>
            </li><li><a href="index.html">Tags</a>
            </li><li><a href="../stories/linux-note.html">Linux 筆記</a>

                </li></ul>
                <ul class="nav pull-right">
                
                
                 
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End of Menubar -->
<div class="container-fluid" id="container-fluid">
    <!--Body content-->
    <div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
    
        <div class="postbox">
        <h1><a href="../posts/build-restful-api-server-by-spray.html">用 Spray 建立一個簡單的 RESTful API Server</a>
        <small>  
             Posted: 2012-11-06 20:11
        </small></h1>
        <hr>
        <p><a class="reference external" href="http://spray.cc/">Spray</a></p>
<p>最初是想要建立一個提供查詢服務的 RESTful API Server，可以讓 Client 的應用程式透過 RESTful API 查詢一些資料。
但是看來看去，用 Play2、Jersey、RESTEasy 等都蠻麻煩的，而且還需要使用 Web container（像 Tomcat、Jetty 等）。
所以才找到這個 Spray，而且又是用 Scala 開發的，實在沒有理由不試試看阿。 XD</p>
<p>若你連到官網看會發現他分成很多模組，老實說我也沒有詳細研究每個模組的功能。
因為 <a class="reference external" href="http://spray.cc/documentation/spray-can/">spray-can</a> 的範例看起來最簡單並且也符合我的需求，所以就直接用他了。</p>
<p>想瞭解更詳細內容的可以參考 <a class="reference external" href="https://github.com/spray/spray/tree/release-1.0-M2/examples/spray-can/simple-http-server/">spray-can 範例文件</a> 與 <a class="reference external" href="http://blog.cloudfoundry.com/2012/05/11/running-standalone-web-applications-on-cloud-foundry/">Running Standalone Web Applications on Cloud Foundry</a></p>
<p><a href="../posts/build-restful-api-server-by-spray.html">Read more...</a></p>
        
    <p>
        <a href="../posts/build-restful-api-server-by-spray.html#disqus_thread" data-disqus-identifier="cache/posts/2012-11-06-spray.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="../posts/akka-2_0-note-6.html">Akka 2.0 筆記(6) - Dispatcher 的設定</a>
        <small>  
             Posted: 2012-06-17 20:19
        </small></h1>
        <hr>
        <p>今天早上先簡單了依照昨天畫得架構圖做了一個雛型，整個跑起來功能是以了，但是流程整個悲劇 Orz ...
先是 Exception Handling 做的不夠好，結果就真的是 "Let it Crash" 一直死一直死一直死，好像在玩 D3 的煉獄模式一樣。</p>
<p>再來是我沒有去設定 Dispatcher 所以 Thread 用了十幾個。如果我沒有看錯的話，依照 Akka <a class="reference external" href="https://github.com/akka/akka/blob/master/akka-actor/src/main/resources/reference.conf">reference.conf</a> 的設定，
Default Dispatcher 使用 fork-join-executor，他的預設設定如下</p>
<pre class="code scala literal-block">
<span class="n">fork</span><span class="o">-</span><span class="n">join</span><span class="o">-</span><span class="n">executor</span> <span class="o">{</span>
  <span class="k">#</span> <span class="nc">Min</span> <span class="n">number</span> <span class="n">of</span> <span class="n">threads</span> <span class="n">to</span> <span class="n">cap</span> <span class="n">factor</span><span class="o">-</span><span class="n">based</span> <span class="n">parallelism</span> <span class="n">number</span> <span class="n">to</span>
  <span class="n">parallelism</span><span class="o">-</span><span class="n">min</span> <span class="k">=</span> <span class="mi">8</span>

  <span class="k">#</span> <span class="nc">Parallelism</span> <span class="o">(</span><span class="n">threads</span><span class="o">)</span> <span class="o">...</span> <span class="n">ceil</span><span class="o">(</span><span class="n">available</span> <span class="n">processors</span> <span class="o">*</span> <span class="n">factor</span><span class="o">)</span>
  <span class="n">parallelism</span><span class="o">-</span><span class="n">factor</span> <span class="k">=</span> <span class="mf">3.0</span>

  <span class="k">#</span> <span class="nc">Max</span> <span class="n">number</span> <span class="n">of</span> <span class="n">threads</span> <span class="n">to</span> <span class="n">cap</span> <span class="n">factor</span><span class="o">-</span><span class="n">based</span> <span class="n">parallelism</span> <span class="n">number</span> <span class="n">to</span>
  <span class="n">parallelism</span><span class="o">-</span><span class="n">max</span> <span class="k">=</span> <span class="mi">64</span>
<span class="o">}</span>
</pre>
<p>很簡單的 parallelism-min 與 parallelism-max 的值代表著 Thread 的上下限，那麼 parallelism_factor 呢？</p>
<p>他同樣也是限制 Thread 的上限，上限的計算方式為</p>
<blockquote>
parallelism-factor * 你的處理器核心數</blockquote>
<p>所以我的四核心桌機使用這個 Dispatcher 最多會開到 12 個 Thread Orz ...</p>
<p><a href="../posts/akka-2_0-note-6.html">Read more...</a></p>
        
    <p>
        <a href="../posts/akka-2_0-note-6.html#disqus_thread" data-disqus-identifier="cache/posts/2012-06-17-akka-note-6-my-aggregator.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="../posts/akka-2_0-note-5.html">Akka 2.0 筆記(5) - Scatter Gather</a>
        <small>  
             Posted: 2012-06-15 08:58
        </small></h1>
        <hr>
        <p>繼上次完全看不懂的 Dataflow 之後，我還是想要一個 Akka 的 Scatter Gather 實作方式，因此想試著自己實做看看。</p>
<p>下圖是 <a class="reference external" href="http://www.eaipatterns.com/">Enterprise Integration Patterns</a>  書中的 Scatter-Gather 概念圖。</p>
<img alt="http://www.eaipatterns.com/img/BroadcastAggregate.gif" src="http://www.eaipatterns.com/img/BroadcastAggregate.gif">
<p>從圖中可以發現，中間對於 Vendor A、B 與 C 進行 Broadcast 的行為跟 Akka 內的 <a class="reference external" href="http://doc.akka.io/docs/akka/2.0/scala/routing.html">Router</a> 很像，
所以當我正在思考 Router 是否合適作為這種用途的時候，我想到了 <a class="reference external" href="http://letitcrash.com/">Let it Crash</a> 裡面 <a class="reference external" href="http://letitcrash.com/post/23532935686/watch-the-routees">Watch the Routees</a> 這篇文章。</p>
<p>這篇文章裡面他紀錄了在 Akka mailinglist 中回答別人問題時所寫的範例程式。</p>
<p>整個 use case 是要執行一個 Job，這個 Job 由許多 Tasks 組成，在執行的過程中</p>
<ol class="arabic simple">
<li>會將這些 Tasks 透過 router 分派給 worker actors 執行。</li>
<li>最後收集所有 worker 的執行結果，並且將他們合併之後回傳。</li>
<li>除此之外， worker 在執行過程中發生錯誤時，應該要進行 retry，在進行幾次 retry 後依然有錯誤時，Worker 就會停止，並且中止整個 Job。</li>
</ol>
<p><a href="../posts/akka-2_0-note-5.html">Read more...</a></p>
        
    <p>
        <a href="../posts/akka-2_0-note-5.html#disqus_thread" data-disqus-identifier="cache/posts/2012-06-15-akka-note-5-aggregator.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="../posts/akka-2_0-note-4.html">Akka 2.0 筆記(4) - Dataflow 請不要期待這篇我會提到什麼</a>
        <small>  
             Posted: 2012-06-12 21:55
        </small></h1>
        <hr>
        <p>這整篇的原因起於，洗澡的時候想到的，
Akka 的 Future 到底有沒有存在的意義呢？</p>
<p>因為當一個 Actor 用 reply 或者 sender 回傳結果的時候，其實可以再 receive 不同的型態的 Message 就好了。
而且這樣還不會因為 Await 而需要 block thread，減少 dead lock 的發生。
我之前就幹過很蠢的事情，因為 Actor 把 Thread Pool 裡面的 Thread 用光了，所以他底下幫他工作的 Actor 就取不到 Thread 可以執行，
因此全部 Timeout Orz ...</p>
<p>目前唯一能想到的用法就是在發出訊息的地方不是一個 Actor 的時候，這時候就沒有 receive 可以接收結果了。
所以需要使用 Future 來等待結果，也就是 Future 應該只被用在需要等待的時候，如果是在一個 Actor 被執行的時候使用 Future。
很容易浪費掉一個 Thread，應該是要另外開一個新的 case class 來專門處理結果才是。</p>
<p>但是這邊又出現了一個更複雜的問題了，因為我將工作分給不同的 Actor 去執行，必須要等到所有 Actor 都執行完畢，整合所有的結果。
那麼如果是用 receive 我要怎樣才能知道我所有的工作都已經完成了呢？</p>
<p>簡單來說，我就是需要實做一個  <a class="reference external" href="http://www.eaipatterns.com/BroadcastAggregate.html">Scatter-Gather</a> ，才會莫名其妙的看到 Akka 的 Dataflow。</p>
<p><a href="../posts/akka-2_0-note-4.html">Read more...</a></p>
        
    <p>
        <a href="../posts/akka-2_0-note-4.html#disqus_thread" data-disqus-identifier="cache/posts/2012-06-12-akka-dataflow.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="../posts/akka-2_0-note-3.html">Akka 2.0 筆記(3) - Future 之實在不是我想要拖稿</a>
        <small>  
             Posted: 2012-06-10 17:30
        </small></h1>
        <hr>
        <p>而是我實在是不擅長寫作，過去作文只有 20 分真的不是拿假的。
前一篇的 <strong>開始使用 Future</strong> 只有介紹一些基本的使用方式而已，然後依照前面的程式碼是絕對跑不起來的 Orz ...</p>
<p><a href="../posts/akka-2_0-note-3.html">Read more...</a></p>
        
    <p>
        <a href="../posts/akka-2_0-note-3.html#disqus_thread" data-disqus-identifier="cache/posts/2012-06-10-akka-note-3-future.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="../posts/akka-2_0-note-2.html">Akka 2.0 筆記 (2) - 開始使用 Future</a>
        <small>  
             Posted: 2012-06-08 12:18
        </small></h1>
        <hr>
        <p>以前再使用 Java Thread 的時候最困擾我的就是 Thread 之間的溝通。
要怎樣讓一個 Thread 去等待另外一個 Thread？要怎樣才能讓工作分配的平均？
最後是靠 BlockingQueue 才讓實作變得簡單一點，
不過想當然問題當然一大堆 ... Orz</p>
<p>所以想來實驗看看 Akka 的 Future 與 Router 到底是如何使用，與可以做到什麼事情。</p>
<p><a href="../posts/akka-2_0-note-2.html">Read more...</a></p>
        
    <p>
        <a href="../posts/akka-2_0-note-2.html#disqus_thread" data-disqus-identifier="cache/posts/2012-05-23-akka-note-2-eventstream.html">Comments</a>

        </p></div>
        <div class="postbox">
        <h1><a href="../posts/akka-2_0-note-1.html">Akka 2.0 筆記 (1)</a>
        <small>  
             Posted: 2012-05-17 18:03
        </small></h1>
        <hr>
        <p>因為我的程式還沒有寫完，所以是筆記 (1)，寫的過程應該還會有 2 3 ... 出現 Orz。</p>
<blockquote>
Akka 2.0 - 要升級了
你的時間的庫存量足夠嗎 ?</blockquote>
<p>Akka 進入了 2.0 時代，恭喜你如果你是用 1.x 的話，請準備改寫吧 ...
先從幾個方面來看 2.0 的新增事項。</p>
<p><a href="../posts/akka-2_0-note-1.html">Read more...</a></p>
        
    <p>
        <a href="../posts/akka-2_0-note-1.html#disqus_thread" data-disqus-identifier="cache/posts/2012-05-17-akka-note-1.html">Comments</a>

        </p></div>
    
<div>
<ul class="pager">
</ul>
</div>

    
       <script type="text/javascript">var disqus_shortname="swindgithub";(function(){var a=document.createElement("script");a.async=true;a.type="text/javascript";a.src="http://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)}());</script>


    </div>
    </div> 
    <!--End of body content-->
</div>

<div class="footerbox">
    Contents © 2013 <a href="mailto:">Swind</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
</div>

    
    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"80%",maxHeight:"80%",scalePhotos:true});</script>

</body>
</html>