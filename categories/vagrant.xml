<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>Corleonis (vagrant)</title><link>http://swind.code-life.info/</link><description></description><language>en</language><lastBuildDate>Tue, 21 Oct 2014 17:01:04 GMT</lastBuildDate><generator>http://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>自製 Vagrant Box</title><link>http://swind.code-life.info/posts/create-vagrant-box.html</link><dc:creator>Swind</dc:creator><description>&lt;div&gt;&lt;p&gt;最近都在使用 Vagrant 以及看在 &lt;a class="reference external" href="http://teddysoft.tw/category/ccagile/"&gt;C.C Agile&lt;/a&gt; 中 &lt;a class="reference external" href="http://ithelp.ithome.com.tw/profile?id=20014061"&gt;beelit94&lt;/a&gt; 所介紹的 Packer。&lt;/p&gt;
&lt;p&gt;目前是使用 Vagrant 來統一公司同事的測試環境，減少因為環境不同而導致的 bug。&lt;/p&gt;
&lt;p&gt;這邊主要是筆記自己建立 box 時所要設定的內容，主要都是參考 &lt;a class="reference external" href="http://williamwalker.me/blog/creating-a-custom-vagrant-box.html"&gt;Creating a Custom Vagrant Box&lt;/a&gt; 的文章。&lt;/p&gt;
&lt;div class="section" id="virtualbox"&gt;
&lt;h2&gt;在 VirtualBox 上安裝系統&lt;/h2&gt;
&lt;p&gt;VirtualBox 安裝 Extension Pack&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
wget http://download.virtualbox.org/virtualbox/4.3.16/Oracle_VM_VirtualBox_Extension_Pack-4.3.16-95972.vbox-extpack
VBoxManage extpack install Oracle_VM_VirtualBox_Extension_Pack-4.3.16-95972.vbox-extpack
&lt;/pre&gt;
&lt;div class="section" id="vagrant"&gt;
&lt;h3&gt;建立 vagrant 帳號&lt;/h3&gt;
&lt;pre class="code bash literal-block"&gt;
useradd -m vagrant
passwd vagrant
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="editor-sudoers"&gt;
&lt;h3&gt;修改預設 editor 與 sudoers&lt;/h3&gt;
&lt;pre class="code bash literal-block"&gt;
sudo update-alternatives --config editor
sudo su -
visudo
&lt;/pre&gt;
&lt;p&gt;增加&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
vagrant ALL=(ALL) NOPASSWD:ALL
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="vagrant-ssh-key-authorized-keys"&gt;
&lt;h3&gt;增加 Vagrant 的 ssh key 到 authorized_keys&lt;/h3&gt;
&lt;pre class="code bash literal-block"&gt;
mkdir -p /home/vagrant/.ssh
wget --no-check-certificate https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub -O /home/vagrant/.ssh/authorized_keys
chmod 0700 /home/vagrant/.ssh
chmod 0600 /home/vagrant/.ssh/authorized_keys
chown -R vagrant /home/vagrant/.ssh
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="nat-eth0"&gt;
&lt;h3&gt;移除已經存在的網路卡 ( 除了第一個 NAT 的 eth0 之外）&lt;/h3&gt;
&lt;p&gt;錯誤訊息&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
The following SSH command responded with a non-zero exit status.
Vagrant assumes that this means the command failed!

/sbin/ip addr flush dev eth1 2&amp;gt; /dev/null

Stdout from the command:



Stderr from the command:

stdin: is not a tty
&lt;/pre&gt;
&lt;p&gt;原因是有可能之前有增加過網路卡，所以 eth1 代表那個已經不存在的網路卡。
導致 vagrant 沒有辦法初始化網路設定&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
sudo vim /etc/udev/rules.d/70-persistent-net.rules
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="virtualbox-guest-additions"&gt;
&lt;h3&gt;安裝 Virtualbox Guest Additions&lt;/h3&gt;
&lt;p&gt;直接到 &lt;a class="reference external" href="http://download.virtualbox.org/virtualbox/"&gt;http://download.virtualbox.org/virtualbox/&lt;/a&gt; 下載對應版本的 Guest Addition，例如 &lt;cite&gt;VBoxGuestAdditions_4.3.18.iso&lt;/cite&gt;&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
wget http://download.virtualbox.org/virtualbox/4.3.18/VBoxGuestAdditions_4.3.18.iso
apt-get install dkms gcc
mount -o loop VBoxGuestAdditions_4.3.18.iso /mnt
&lt;span class="nb"&gt;cd&lt;/span&gt; /mnt
./VBoxLinuxAdditions.run
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="box"&gt;
&lt;h3&gt;打包成 box&lt;/h3&gt;
&lt;p&gt;&amp;lt;vm-name&amp;gt; 的部份需要自己換成 VM 的名稱&lt;/p&gt;
&lt;p&gt;..code:: bash&lt;/p&gt;
&lt;blockquote&gt;
vagrant package --base &amp;lt;vm-name&amp;gt;&lt;/blockquote&gt;
&lt;div class="figure"&gt;
&lt;img alt="https://dl.dropboxusercontent.com/u/15537823/Blog/Lord_Marksman_and_Vanadis.jpg" src="https://dl.dropboxusercontent.com/u/15537823/Blog/Lord_Marksman_and_Vanadis.jpg"&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;これは英雄へと至る物語&lt;/p&gt;
&lt;/blockquote&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</description><category>vagrant</category><guid>http://swind.code-life.info/posts/create-vagrant-box.html</guid><pubDate>Thu, 25 Sep 2014 08:16:25 GMT</pubDate></item></channel></rss>