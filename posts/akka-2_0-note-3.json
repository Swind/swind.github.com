{"THEME_REVEAL_CONGIF_TRANSITION": "cube", "message_Previous post": "Previous post", "LICENSE": "\n<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-sa/2.5/ar/\">\n<img alt=\"Creative Commons License BY-NC-SA\"\nstyle=\"border-width:0; margin-bottom:12px;\"\nsrc=\"http://i.creativecommons.org/l/by-nc-sa/2.5/ar/88x31.png\"></a>", "text": "<html><body><p>\u800c\u662f\u6211\u5be6\u5728\u662f\u4e0d\u64c5\u9577\u5beb\u4f5c\uff0c\u904e\u53bb\u4f5c\u6587\u53ea\u6709 20 \u5206\u771f\u7684\u4e0d\u662f\u62ff\u5047\u7684\u3002\n\u524d\u4e00\u7bc7\u7684 <strong>\u958b\u59cb\u4f7f\u7528 Future</strong> \u53ea\u6709\u4ecb\u7d39\u4e00\u4e9b\u57fa\u672c\u7684\u4f7f\u7528\u65b9\u5f0f\u800c\u5df2\uff0c\u7136\u5f8c\u4f9d\u7167\u524d\u9762\u7684\u7a0b\u5f0f\u78bc\u662f\u7d55\u5c0d\u8dd1\u4e0d\u8d77\u4f86\u7684 Orz ...</p>\n<!-- TEASER_END -->\n<p>\u539f\u56e0\u5728\u65bc Future \u9700\u8981\u4e00\u500b Execution Contexts \u985e\u4f3c Java \u88e1\u9762\u7684 Executor\uff0c\u4e5f\u5c31\u662f Thread Pool\u3002</p>\n<div class=\"section\" id=\"execution-contexts\">\n<h2>Execution Contexts</h2>\n<p>\u56e0\u70ba Future \u9664\u4e86\u8ddf Actor \u914d\u5408\u4f7f\u7528\u4e4b\u5916\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002</p>\n<p>\u4f8b\u5982\u524d\u9762\u8207 Actor \u914d\u5408\u4f7f\u7528\u7684\u4f8b\u5b50scala</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">list</span> <span class=\"k\">=</span> <span class=\"nc\">List</span><span class=\"o\">[</span><span class=\"kt\">String</span><span class=\"o\">](</span><span class=\"s\">\"Tony\"</span><span class=\"o\">,</span><span class=\"s\">\"Lion\"</span><span class=\"o\">,</span><span class=\"s\">\"Teddy\"</span><span class=\"o\">,</span><span class=\"s\">\"Brain\"</span><span class=\"o\">,</span><span class=\"s\">\"Jess\"</span><span class=\"o\">,</span><span class=\"s\">\"Kay\"</span><span class=\"o\">,</span><span class=\"s\">\"Michael\"</span><span class=\"o\">)</span>\n<span class=\"k\">val</span> <span class=\"n\">listOfFutures</span> <span class=\"k\">=</span> <span class=\"n\">list</span> <span class=\"n\">map</span> <span class=\"o\">{</span>\n   <span class=\"n\">name</span> <span class=\"k\">=&gt;</span>\n      <span class=\"o\">(</span><span class=\"n\">countActor</span> <span class=\"o\">?</span> <span class=\"n\">name</span><span class=\"o\">).</span><span class=\"n\">mapTo</span><span class=\"o\">[</span><span class=\"kt\">Int</span><span class=\"o\">]</span>\n<span class=\"o\">}</span>\n<span class=\"k\">val</span> <span class=\"n\">futureList</span> <span class=\"k\">=</span> <span class=\"nc\">Future</span><span class=\"o\">.</span><span class=\"n\">sequence</span><span class=\"o\">(</span><span class=\"n\">listOfFutures</span><span class=\"o\">)</span>\n</pre>\n<p>\u5176\u5be6\u53ef\u4ee5\u6539\u6210\u9019\u6a23:</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">futureList</span> <span class=\"k\">=</span> <span class=\"nc\">Future</span><span class=\"o\">.</span><span class=\"n\">sequence</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"o\">.</span><span class=\"n\">map</span><span class=\"o\">(</span><span class=\"n\">name</span> <span class=\"k\">=&gt;</span> <span class=\"nc\">Future</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">length</span><span class=\"o\">)))</span>\n</pre>\n<p>\u56e0\u6b64\u5728\u4f7f\u7528 Future \u4e4b\u524d\u5fc5\u9808\u8981\u8a2d\u5b9a ExecutionContext \u8b93 Future \u53ef\u7528\u4f86\u57f7\u884c\u5de5\u4f5c\u3002</p>\n<dl class=\"docutils\">\n<dt>P.S</dt>\n<dd>\u9019\u6a23\u7684\u7d50\u679c\u4e5f\u662f\u6703\u56de\u50b3\u4e00\u500b Future[List[Int]]\u3002\n\u5f88\u660e\u986f\u7684\u9019\u6a23\u7684\u4f5c\u6cd5\u7c21\u55ae\u5f88\u591a\uff0c\u56e0\u70ba\u5c11\u5efa\u7acb Actor \u4e5f\u4e0d\u9700\u8981\u518d\u5c07 Actor \u6240\u56de\u50b3\u7684\u503c\u8f49\u578b\uff08\u5c31\u662f\u524d\u9762\u770b\u5230\u7684 mapTo[Int]\uff09\u3002\n\u6211\u662f\u9084\u883b\u559c\u6b61\u9019\u6a23\u505a\u7684\uff0c\u4e0d\u904e\u7531\u65bc\u5f8c\u9762\u8981\u4f7f\u7528\u5230 Router \u6240\u4ee5\u5c31\u6c92\u6709\u76f4\u63a5\u4f7f\u7528 Future \u4e86\u3002</dd>\n</dl>\n<div class=\"section\" id=\"execution-context\">\n<h3>\u8a2d\u5b9a Execution Context</h3>\n<p>\u96d6\u7136\u6587\u4ef6\u4e2d\u6709\u63d0\u5230\u5982\u679c scope \u5167\u5b58\u5728 ActorSystem \uff0c\u4ed6\u6703\u81ea\u5df1\u4f7f\u7528 ActorSystem \u7684 default dispatcher\uff0c\n\u4e0d\u904e\u5f88\u53ef\u60dc\u7684\u9019\u500b\u529f\u80fd\u6211\u6c92\u6709\u6e2c\u8a66\u51fa\u4f86\uff0c\u4e0d\u7136\u5c31\u662f\u6211\u8aa4\u89e3\u4e86\u9019\u6bb5\u8a71\u7684\u610f\u601d\u3002\n\u5982\u679c\u6709\u671d\u4e00\u65e5\u6211\u7a81\u7136\u958b\u609f\u60f3\u901a\u4e86\u518d\u4f86\u88dc\u4e0a\u9019\u4e00\u6bb5\u3002</p>\n<p>\u800c\u5728 Akka \u88e1\u9762\u6240\u6709\u7684 Dispatcher \u90fd\u662f\u7e7c\u627f\u81ea ExecutionContext\n\u6240\u4ee5\u8981\u8a2d\u5b9a\u9019\u500b\u4e5f\u4e0d\u592a\u82b1\u6642\u9593\u3002</p>\n<p>\u5982\u679c\u8981\u4f7f\u7528 Future \u7684\u662f\u4e00\u500b Actor\uff0c\u90a3\u9ebc\u53ea\u8981\u76f4\u63a5\u8a2d\u5b9a Actor \u7684 dispatcher \u5c31\u53ef\u4ee5\u4e86\u3002</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">class</span> <span class=\"nc\">MyActor</span> <span class=\"k\">extends</span> <span class=\"nc\">Actor</span><span class=\"o\">{</span>\n<span class=\"k\">implicit</span> <span class=\"k\">val</span> <span class=\"n\">defaultDispatch</span> <span class=\"k\">=</span> <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">dispatcher</span>\n<span class=\"o\">.</span>\n<span class=\"o\">.</span>\n<span class=\"o\">.</span>\n<span class=\"o\">}</span>\n</pre>\n<p>\u81f3\u65bc\u70ba\u4ec0\u9ebc\u8981\u4f7f\u7528 implicit \u5462\uff1f\u56e0\u70ba Future \u7684 Function \u4e2d dispatcher \u90fd\u662f\u7528 implicit \u7684\u578b\u614b\uff0c\n\u6240\u4ee5\u5982\u679c\u6c92\u6709\u50b3\u53c3\u6578\u7d66\u4ed6\u7684\u6642\u5019\uff0c\u4ed6\u6703\u81ea\u52d5\u5728\u9019\u500b scope \u88e1\u9762\u627e\u5c0b\u662f\u5426\u6709\u5ba3\u544a\u6210 implicit \u7684 ExecutionContext \u8b8a\u6578\u3002</p>\n<p>\u5982\u679c\u4f7f\u7528 Future \u7684\u5730\u65b9\u4e0d\u662f\u5728 Actor \u5167\uff0c\u6216\u4e0d\u60f3\u4f7f\u7528 Actor \u7684 dispatch\u3002\u90a3\u9ebc\u53ef\u4ee5\u81ea\u5df1\u5efa\u7acb Java \u7684 Executor \uff0c\u4e26\u4e14\u5c07\u4ed6\u8f49\u6210 ExecutionContext\u3002</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">es</span> <span class=\"k\">=</span> <span class=\"nc\">Executors</span><span class=\"o\">.</span><span class=\"n\">newFixedThreadPool</span><span class=\"o\">(</span><span class=\"n\">threadSize</span><span class=\"o\">)</span>             <span class=\"c1\">//Java Executor\n</span><span class=\"k\">implicit</span> <span class=\"k\">val</span> <span class=\"n\">ec</span> <span class=\"k\">=</span> <span class=\"nc\">ExecutionContext</span><span class=\"o\">.</span><span class=\"n\">fromExecutorService</span><span class=\"o\">(</span><span class=\"n\">es</span><span class=\"o\">)</span>\n</pre>\n<p>\u9019\u6a23\u5728\u4f7f\u7528 Future \u7684\u6642\u5019\u4ed6\u5c31\u6703\u81ea\u52d5\u53bb\u627e ExecutionContext \u4f86\u57f7\u884c\u3002</p>\n</div>\n</div>\n<div class=\"section\" id=\"future-exception\">\n<h2>\u5982\u679c Future \u57f7\u884c\u7684\u904e\u7a0b\u4e2d\u6709\u767c\u751f Exception</h2>\n<p>Future \u7528 <strong>recover</strong> \u8207 <strong>recoverWith</strong> \u4f86\u8655\u7406 Future \u57f7\u884c\u904e\u7a0b\u4e2d\u7684\u6240\u4e1f\u51fa\u7684 Exception\u3002</p>\n<p>\u4f7f\u7528\u65b9\u5f0f\u975e\u5e38\u7684\u7c21\u55ae\uff0c\u5beb\u8d77\u4f86\u4e5f\u883b\u6f02\u4eae\u7684\uff0c\u53ea\u8981\u5728\u5efa\u7acb Future \u6642\u4f7f\u7528 recover \u6216 recoverWith \u4e26\u4e14\u52a0\u5165\u8981\u8655\u7406\u7684\u4f8b\u5916\u5c31\u597d\u4e86\u3002</p>\n<p>\u4f8b\u5982</p>\n<pre class=\"code scala literal-block\">\n<span class=\"nc\">Future</span><span class=\"o\">(</span><span class=\"n\">parsePage</span><span class=\"o\">(</span><span class=\"n\">pageNumber</span><span class=\"o\">))</span> <span class=\"n\">recover</span> <span class=\"o\">{</span> <span class=\"k\">case</span> <span class=\"n\">e</span><span class=\"k\">:</span><span class=\"kt\">Exception</span> <span class=\"o\">=&gt;</span> <span class=\"nc\">List</span><span class=\"o\">[</span><span class=\"kt\">Post</span><span class=\"o\">]()</span> <span class=\"o\">}</span>\n</pre>\n<p>\u4e0a\u9762\u8868\u793a\u7576\u6211\u57f7\u884c parsePage \u6642\u5982\u679c\u767c\u751f\u4efb\u4f55 Excetpion \u90a3\u9ebc\u5c31\u56de\u50b3\u4e00\u500b\u7a7a\u7684 list\u3002</p>\n<p>\u800c recover \u8207 recoverWith \u7684\u5dee\u5225\u5c31\u5728\u65bc\uff0crecoverWith \u5167\u7684 Function \u8981\u56de\u50b3\u7684\u578b\u614b\u662f Future[Int] \u800c recover \u5247\u662f Int\u3002</p>\n<p>\u665a\u9ede\u6574\u7406\u4e00\u500b\u4f7f\u7528 Future \u7684\u5b8c\u6574\u4f8b\u5b50\u597d\u4e86\uff0c\u73fe\u5728\u5beb\u7684\u6771\u897f\u771f\u7684\u592a\u4e0d\u5165\u6d41\u4e86 XDDDDDD\n\u6211\u5f88\u96e3\u628a\u7a0b\u5f0f\u78bc\u76f4\u63a5\u8cbc\u4e0a\u4f86\u7576\u7bc4\u4f8b\u3002</p>\n</div></body></html>", "ARCHIVE_FILENAME": "archive.html", "THEME_REVEAL_CONGIF_SUBTHEME": "sky", "message_Read more": "Read more", "SITE_URL": "http://swind.code-life.info", "LISTINGS_FOLDER": "listings", "INDEXES_PAGES": "", "next": "/posts/akka-2_0-note-4.json", "message_Next post": "Next post", "BLOG_DESCRIPTION": "I am Swind.", "EXTRA_HEAD_DATA": "", "DEFAULT_LANG": "en", "disqus_html": "<div id=\"disqus_thread\"></div> <script type=\"text/javascript\">var disqus_shortname=\"swindgithub\";var disqus_url=\"http://swind.code-life.info/posts/akka-2_0-note-3.html\";(function(){var a=document.createElement(\"script\");a.type=\"text/javascript\";a.async=true;a.src=\"http://\"+disqus_shortname+\".disqus.com/embed.js\";(document.getElementsByTagName(\"head\")[0]||document.getElementsByTagName(\"body\")[0]).appendChild(a)})();        </script><noscript>Please enable JavaScript to view the <a href=\"http://disqus.com/?ref_noscript\">comments powered by DISQUS.</a></noscript><a href=\"http://disqus.com\"class=\"dsq-brlink\">comments powered by <span class=\"logo-disqus\">DISQUS</span></a>", "RSS_PATH": "", "title": "Akka 2.0 \u7b46\u8a18(3) - Future \u4e4b\u5be6\u5728\u4e0d\u662f\u6211\u60f3\u8981\u62d6\u7a3f", "SEARCH_FORM": "", "message_Tags": "Tags", "INDEX_PATH": "", "BLOG_AUTHOR": "Swind", "message_Older posts": "Older posts", "OUTPUT_FOLDER": "output", "message_Original site": "Original site", "ANALYTICS": "UA-15910682-2", "BLOG_EMAIL": "", "message_Posts for year %s": "Posts for year %s", "message_old posts page %d": "old posts page %d", "BLOG_TITLE": "Corleonis", "message_Posted": "Posted", "GALLERY_PATH": "galleries", "CODE_COLOR_SCHEME": "default", "message_Read in English": "Read in English", "CACHE_FOLDER": "cache", "tags": [{"link": "/categories/scala.html", "name": "Scala"}, {"link": "/categories/akka.html", "name": "Akka"}], "tags?": true, "__file__": "conf.pyc", "translations": [], "CONTENT_FOOTER": "Contents &copy; 2013 <a href=\"mailto:\">Swind</a> - Powered by <a href=\"http://nikola.ralsina.com.ar\">Nikola</a>", "BASE_URL": "http://swind.code-life.info", "THEME": "mySite", "message_Also available in": "Also available in", "BLOG_URL": "http://swind.code-life.info", "date": "2012-06-10 17:30", "__name__": "conf", "message_Posts about %s": "Posts about %s", "message_Posts for {month} {year}": "Posts for {month} {year}", "message_More posts about": "More posts about", "ARCHIVE_PATH": "", "DATE_FORMAT": "%Y-%m-%d %H:%M", "TAG_PATH": "categories", "prev": "/posts/akka-2_0-note-2.json", "message_Newer posts": "Newer posts", "message_LANGUAGE": "English", "MATHJAX_CONFIG": "", "message_Archive": "Archive", "message_Source": "Source", "DISQUS_FORUM": "swindgithub", "INDEXES_TITLE": ""}