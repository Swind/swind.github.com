{"THEME_REVEAL_CONGIF_TRANSITION": "cube", "message_Previous post": "Previous post", "LICENSE": "\n<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-sa/2.5/ar/\">\n<img alt=\"Creative Commons License BY-NC-SA\"\nstyle=\"border-width:0; margin-bottom:12px;\"\nsrc=\"http://i.creativecommons.org/l/by-nc-sa/2.5/ar/88x31.png\"></a>", "text": "<html><body><p>\u4ee5\u524d\u518d\u4f7f\u7528 Java Thread \u7684\u6642\u5019\u6700\u56f0\u64fe\u6211\u7684\u5c31\u662f Thread \u4e4b\u9593\u7684\u6e9d\u901a\u3002\n\u8981\u600e\u6a23\u8b93\u4e00\u500b Thread \u53bb\u7b49\u5f85\u53e6\u5916\u4e00\u500b Thread\uff1f\u8981\u600e\u6a23\u624d\u80fd\u8b93\u5de5\u4f5c\u5206\u914d\u7684\u5e73\u5747\uff1f\n\u6700\u5f8c\u662f\u9760 BlockingQueue \u624d\u8b93\u5be6\u4f5c\u8b8a\u5f97\u7c21\u55ae\u4e00\u9ede\uff0c\n\u4e0d\u904e\u60f3\u7576\u7136\u554f\u984c\u7576\u7136\u4e00\u5927\u5806 ... Orz</p>\n<p>\u6240\u4ee5\u60f3\u4f86\u5be6\u9a57\u770b\u770b Akka \u7684 Future \u8207 Router \u5230\u5e95\u662f\u5982\u4f55\u4f7f\u7528\uff0c\u8207\u53ef\u4ee5\u505a\u5230\u4ec0\u9ebc\u4e8b\u60c5\u3002</p>\n<!-- TEASER_END -->\n<div class=\"section\" id=\"future\">\n<h2>Future</h2>\n<p>\u8acb\u642d\u914d Akka \u5b98\u7db2 <a class=\"reference external\" href=\"http://doc.akka.io/docs/akka/2.0/scala/futures.html\">Future</a> \u670d\u7528\u3002</p>\n<p>\u770b Future \u4e00\u5b9a\u8981\u770b\u4e00\u4e0b\u6587\u4ef6\u7b2c\u4e00\u53e5\u8a71</p>\n<blockquote>\nIn Akka, a Future is a data structure used to retrieve the result of some concurrent operation.</blockquote>\n<p>\u662f\u7684\uff0c\u4ed6\u53ea\u662f\u4e00\u500b Data Structure \u800c\u5df2\uff0c<strong>Future \u6700\u4e3b\u8981\u7684\u529f\u80fd\u5c31\u662f\u53ef\u4ee5\u900f\u904e\u4ed6\u53d6\u5f97 Actor \u56de\u50b3\u7684 message</strong>\n\u4e5f\u53ef\u4ee5\u5c07\u4ed6\u60f3\u6210\u4ed6\u4ee3\u8868\u6211\u5011\u672a\u4f86\u6703\u53d6\u5f97\u7684\u56de\u50b3\u503c\uff0c\u6211\u60f3\u9019\u4e5f\u5c31\u662f\u5b83\u53eb\u505a Future \u7684\u539f\u56e0\u4e86\u3002</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">implicit</span> <span class=\"k\">val</span> <span class=\"n\">timeout</span> <span class=\"k\">=</span> <span class=\"nc\">Timeout</span><span class=\"o\">(</span><span class=\"mi\">5</span> <span class=\"n\">seconds</span><span class=\"o\">)</span>\n<span class=\"k\">val</span> <span class=\"n\">future</span> <span class=\"k\">=</span> <span class=\"n\">actor</span> <span class=\"o\">?</span> <span class=\"n\">msg</span> <span class=\"c1\">// enabled by the \"ask\" import\n</span><span class=\"k\">val</span> <span class=\"n\">result</span> <span class=\"k\">=</span> <span class=\"nc\">Await</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"o\">(</span><span class=\"n\">future</span><span class=\"o\">,</span> <span class=\"n\">timeout</span><span class=\"o\">.</span><span class=\"n\">duration</span><span class=\"o\">).</span><span class=\"n\">asInstanceOf</span><span class=\"o\">[</span><span class=\"kt\">String</span><span class=\"o\">]</span>\n</pre>\n<p>\u5077\u4e00\u4e0b\u5b98\u7db2\u7684\u7bc4\u4f8b\uff0c\u6211\u5011\u4e00\u884c\u4e00\u884c\u770b\u4e0a\u9762\u7684\u7a0b\u5f0f\u78bc\u3002</p>\n<p>\u4e00\u958b\u59cb\u7684</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">implicit</span> <span class=\"k\">val</span> <span class=\"n\">timeout</span> <span class=\"k\">=</span> <span class=\"nc\">Timeout</span><span class=\"o\">(</span><span class=\"mi\">5</span> <span class=\"n\">seconds</span><span class=\"o\">)</span>\n</pre>\n<p>\u5c31\u5148\u5ffd\u7565 implicit \u5427\uff0c\u56e0\u70ba\u9019\u908a\u9084\u6c92\u6709\u7528\u5230 implicit \u7684\u7279\u6027\u3002</p>\n<p>\u73fe\u5728\u53ea\u8981\u77e5\u9053\u4ed6\u5efa\u7acb\u4e86\u4e00\u500b Timeout \u7269\u4ef6\uff0c\u5167\u5bb9\u662f 5 seconds\uff0c\u9019\u500b\u5728\u4e4b\u5f8c\u8a2d\u5b9a wait timeout \u7684\u6642\u5019\u6703\u7528\u5230\u2027\n\u70ba\u4e86\u907f\u514d\u7121\u6b62\u76e1\u7684\u7b49\u5f85\uff0c\u5728 Actor \u88e1\u9762\u53ea\u8981\u6709\u95dc\u7b49\u5f85\u7684\u64cd\u4f5c\u90fd\u8981\u7d66\u4e00\u500b Timeout \u6642\u9593\u3002</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">future</span> <span class=\"k\">=</span> <span class=\"n\">actor</span> <span class=\"o\">?</span> <span class=\"n\">msg</span> <span class=\"c1\">// enabled by the \"ask\" import</span>\n</pre>\n<p>\u9019\u88e1\u767c\u4e00\u500b msg \u7d66 actor \uff0c\u7279\u5225\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u662f\u9019\u88e1\u4e0d\u662f\u4f7f\u7528* ! <em>\u800c\u662f</em> ? <em>\u3002\n\u8981\u4f7f\u7528\u9019\u500b ? \u9700\u8981 *import akka.pattern.ask</em>\uff0c\u8ddf ! \u4e0d\u4e00\u6a23\u7684\u5730\u65b9\u5728\u65bc\u4ed6\u6703\u56de\u50b3\u4e00\u500b Future[Any] \u7269\u4ef6</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">result</span> <span class=\"k\">=</span> <span class=\"nc\">Await</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"o\">(</span><span class=\"n\">future</span><span class=\"o\">,</span><span class=\"n\">timeout</span><span class=\"o\">.</span><span class=\"n\">duration</span><span class=\"o\">).</span><span class=\"n\">asInstanceOf</span><span class=\"o\">[</span><span class=\"kt\">String</span><span class=\"o\">]</span>\n</pre>\n<p>\u6700\u5f8c\u4f7f\u7528 Await \u4f86\u900f\u904e Future \u53d6\u5f97 Actor \u7684\u56de\u50b3\u503c\uff0c\u4e26\u4e14\u8a2d\u5b9a\u4e00\u500b timeout \u6642\u9593\uff0c\u5982\u679c\u6642\u9593\u5230 Actor \u6c92\u6709\u56de\u50b3\u4efb\u4f55\u6771\u897f\u7684\u8a71\uff0c\u5c31\u6703\u4e1f\u51fa\u4e00\u500b Timeout Exception\u3002</p>\n<div class=\"section\" id=\"actor\">\n<h3>\u5982\u679c\u8981\u7b49\u5f85\u5f88\u591a\u500b Actor \u56de\u50b3\u503c\u5462\uff1f</h3>\n<p>\u5982\u679c\u8981\u5c07\u5de5\u4f5c\u5206\u6d3e\u7d66\u591a\u500b Actor \u9032\u884c\u904b\u4f5c\uff0c\u90a3\u9ebc\u6700\u76f4\u89ba\u7684\u60f3\u6cd5\u5c31\u662f</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">f1</span> <span class=\"k\">=</span> <span class=\"n\">actor1</span> <span class=\"o\">?</span> <span class=\"n\">msg1</span>\n<span class=\"k\">val</span> <span class=\"n\">f2</span> <span class=\"k\">=</span> <span class=\"n\">actor2</span> <span class=\"o\">?</span> <span class=\"n\">msg2</span>\n\n<span class=\"k\">val</span> <span class=\"n\">a</span> <span class=\"k\">=</span> <span class=\"nc\">Await</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"o\">(</span><span class=\"n\">f1</span><span class=\"o\">,</span> <span class=\"mi\">1</span> <span class=\"n\">second</span><span class=\"o\">).</span><span class=\"n\">asInstanceOf</span><span class=\"o\">[</span><span class=\"kt\">Int</span><span class=\"o\">]</span>\n<span class=\"k\">val</span> <span class=\"n\">b</span> <span class=\"k\">=</span> <span class=\"nc\">Await</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"o\">(</span><span class=\"n\">f2</span><span class=\"o\">,</span> <span class=\"mi\">1</span> <span class=\"n\">second</span><span class=\"o\">).</span><span class=\"n\">asInstanceOf</span><span class=\"o\">[</span><span class=\"kt\">Int</span><span class=\"o\">]</span>\n\n<span class=\"k\">val</span> <span class=\"n\">f3</span> <span class=\"k\">=</span> <span class=\"n\">actor3</span> <span class=\"o\">?</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">+</span><span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"k\">val</span> <span class=\"n\">result</span> <span class=\"k\">=</span> <span class=\"nc\">Await</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"o\">(</span><span class=\"n\">f3</span><span class=\"o\">,</span> <span class=\"mi\">1</span> <span class=\"n\">second</span><span class=\"o\">).</span><span class=\"n\">asInstanceOf</span><span class=\"o\">[</span><span class=\"kt\">Int</span><span class=\"o\">]</span>\n</pre>\n<p>\u6211\u5148\u5c07\u5de5\u4f5c\u767c\u7d66 actor1 \u7b49\u4ed6\u56de\u50b3\uff0c\u7136\u5f8c\u518d\u767c\u7d66 actor2 \u7b49\u5f85\u56de\u50b3\uff0c\u6700\u5f8c\u5728\u5c07\u56de\u50b3\u7d50\u679c\u767c\u7d66 actor3\u3002</p>\n<p>\u70ba\u4e86\u8981\u53d6\u5f97 a\u3001b \u800c\u4f7f\u7528\u4e86 Await \u5169\u6b21\uff0c\u9019\u6a23\u7684\u4f5c\u6cd5\u975e\u5e38\u6c92\u6709\u6548\u7387\uff0c\u56e0\u6b64\u6709\u4e86 sequence \u8207 traverse \u9019\u5169\u500b function\u3002</p>\n<p>\u8209\u4f8b\u4f86\u8aaa\uff0c\u5982\u679c\u6211\u6709\u4e00\u500b</p>\n<pre class=\"code scala literal-block\">\n<span class=\"nc\">List</span><span class=\"o\">[</span><span class=\"kt\">String</span><span class=\"o\">](</span><span class=\"s\">\"Tony\"</span><span class=\"o\">,</span><span class=\"s\">\"Lion\"</span><span class=\"o\">,</span><span class=\"s\">\"Teddy\"</span><span class=\"o\">,</span><span class=\"s\">\"Brain\"</span><span class=\"o\">,</span><span class=\"s\">\"Jess\"</span><span class=\"o\">,</span><span class=\"s\">\"Kay\"</span><span class=\"o\">,</span><span class=\"s\">\"Michael\"</span><span class=\"o\">)</span>\n</pre>\n<p>\u4e26\u4e14\u60f3\u8981\u9019\u500b List \u5167\u6240\u6709\u5b57\u4e32\u7684\u9577\u5ea6\u7e3d\u548c\u3002</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">list</span> <span class=\"k\">=</span> <span class=\"nc\">List</span><span class=\"o\">[</span><span class=\"kt\">String</span><span class=\"o\">](</span><span class=\"s\">\"Tony\"</span><span class=\"o\">,</span><span class=\"s\">\"Lion\"</span><span class=\"o\">,</span><span class=\"s\">\"Teddy\"</span><span class=\"o\">,</span><span class=\"s\">\"Brain\"</span><span class=\"o\">,</span><span class=\"s\">\"Jess\"</span><span class=\"o\">,</span><span class=\"s\">\"Kay\"</span><span class=\"o\">,</span><span class=\"s\">\"Michael\"</span><span class=\"o\">)</span>\n<span class=\"k\">val</span> <span class=\"n\">listOfFutures</span> <span class=\"k\">=</span> <span class=\"n\">list</span> <span class=\"n\">map</span> <span class=\"o\">{</span>\n   <span class=\"n\">name</span> <span class=\"k\">=&gt;</span>\n      <span class=\"o\">(</span><span class=\"n\">countActor</span> <span class=\"o\">?</span> <span class=\"n\">name</span><span class=\"o\">).</span><span class=\"n\">mapTo</span><span class=\"o\">[</span><span class=\"kt\">Int</span><span class=\"o\">]</span>\n<span class=\"o\">}</span>\n</pre>\n<p>\u5728\u9019\u908a\u6211\u5011\u5f97\u5230\u4e86\u4e00\u500b\u578b\u614b\u70ba List[Future[Int]] \u7684 listOfFutures\uff0c\u518d\u4f86\u5c31\u53ef\u4ee5\u4f7f\u7528 sequence \u5c07\u5176\u8f49\u6210 Future[List[Int]]\n\u6700\u5f8c\u5c31\u53ef\u4ee5\u4f7f\u7528 Await \u4f86\u53d6\u5f97\u6240\u6709\u5b57\u4e32\u9577\u5ea6\u4e86\uff0c\u4e26\u4e14\u7d71\u8a08\u5b57\u6578\u4e86\u3002</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">futureList</span> <span class=\"k\">=</span> <span class=\"nc\">Future</span><span class=\"o\">.</span><span class=\"n\">sequence</span><span class=\"o\">(</span><span class=\"n\">listOfFutures</span><span class=\"o\">)</span>\n<span class=\"k\">val</span> <span class=\"n\">lengthList</span> <span class=\"k\">=</span> <span class=\"nc\">Await</span><span class=\"o\">.</span><span class=\"n\">result</span><span class=\"o\">(</span><span class=\"n\">futureList</span><span class=\"o\">,</span><span class=\"mi\">1</span> <span class=\"n\">second</span><span class=\"o\">)</span>\n</pre>\n<p>\u800c sequence \u8207 traverse \u5169\u500b\u4e0d\u4e00\u6a23\u7684\u5730\u65b9\u5728\u65bc\u8aaa</p>\n<p>sequence \u63a5\u53d7\u4e00\u500b List[Future[A]] \u8f49\u6210 Future[List[A]]\u3002</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">futureList</span><span class=\"k\">:</span><span class=\"kt\">Future</span><span class=\"o\">[</span><span class=\"kt\">List</span><span class=\"o\">[</span><span class=\"kt\">Int</span><span class=\"o\">]]</span> <span class=\"k\">=</span> <span class=\"nc\">Future</span><span class=\"o\">.</span><span class=\"n\">sequence</span><span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"n\">to</span> <span class=\"mi\">100</span><span class=\"o\">).</span><span class=\"n\">toList</span><span class=\"o\">.</span><span class=\"n\">map</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"k\">=&gt;</span><span class=\"nc\">Future</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"o\">)))</span>\n</pre>\n<p>\u800c traverse \u5247\u662f\u63a5\u53d7\u4e00\u500b List[B] \u8207\u4e00\u500b function (B=&gt;Future[A]) \u6700\u5f8c\u4e5f\u662f\u7522\u751f Future[List[A]]</p>\n<pre class=\"code scala literal-block\">\n<span class=\"k\">val</span> <span class=\"n\">futureList</span><span class=\"k\">:</span><span class=\"kt\">Future</span><span class=\"o\">[</span><span class=\"kt\">List</span><span class=\"o\">[</span><span class=\"kt\">Int</span><span class=\"o\">]]</span> <span class=\"k\">=</span> <span class=\"nc\">Future</span><span class=\"o\">.</span><span class=\"n\">traverse</span><span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"n\">to</span> <span class=\"mi\">100</span><span class=\"o\">).</span><span class=\"n\">toList</span><span class=\"o\">)(</span><span class=\"n\">x</span> <span class=\"k\">=&gt;</span> <span class=\"nc\">Future</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"o\">))</span>\n</pre>\n<p>\u7528 traverse \u7684\u597d\u8655\u5728\u65bc\u5c11\u7522\u751f\u4e86\u4e2d\u9593\u904e\u7a0b\u7684 List[Future[Int]] (\u81f3\u5c11\u6211\u5011\u7684\u7a0b\u5f0f\u78bc\u770b\u4e0d\u5230\uff0c\u80cc\u5f8c\u5be6\u969b\u4e0a\u6709\u6c92\u6709\u6211\u5c31\u4e0d\u78ba\u5b9a\u4e86\uff0c\u4e0d\u904e\u6587\u4ef6\u662f\u9019\u6a23\u8aaa\u7684)\uff0c\u800c\u76f4\u63a5\u7522\u751f\u4e86 Future[List[Int]]\u3002</p>\n<p>\u5beb\u4e86\u9019\u9ebc\u4e45\uff0c\u624d\u5beb\u9019\u9ebc\u4e00\u9ede\u9ede Orz ... \u800c\u4e14\u9084\u5b8c\u5168\u6c92\u6709\u9032\u5165\u91cd\u9ede\u3002</p>\n</div>\n</div></body></html>", "ARCHIVE_FILENAME": "archive.html", "THEME_REVEAL_CONGIF_SUBTHEME": "sky", "message_Read more": "Read more", "SITE_URL": "http://swind.code-life.info", "LISTINGS_FOLDER": "listings", "INDEXES_PAGES": "", "next": "/posts/akka-2_0-note-3.json", "message_Next post": "Next post", "BLOG_DESCRIPTION": "I am Swind.", "EXTRA_HEAD_DATA": "", "DEFAULT_LANG": "en", "disqus_html": "<div id=\"disqus_thread\"></div> <script type=\"text/javascript\">var disqus_shortname=\"swindgithub\";var disqus_url=\"http://swind.code-life.info/posts/akka-2_0-note-2.html\";(function(){var a=document.createElement(\"script\");a.type=\"text/javascript\";a.async=true;a.src=\"http://\"+disqus_shortname+\".disqus.com/embed.js\";(document.getElementsByTagName(\"head\")[0]||document.getElementsByTagName(\"body\")[0]).appendChild(a)})();        </script><noscript>Please enable JavaScript to view the <a href=\"http://disqus.com/?ref_noscript\">comments powered by DISQUS.</a></noscript><a href=\"http://disqus.com\"class=\"dsq-brlink\">comments powered by <span class=\"logo-disqus\">DISQUS</span></a>", "RSS_PATH": "", "title": "Akka 2.0 \u7b46\u8a18 (2) - \u958b\u59cb\u4f7f\u7528 Future", "SEARCH_FORM": "", "message_Tags": "Tags", "INDEX_PATH": "", "BLOG_AUTHOR": "Swind", "message_Older posts": "Older posts", "OUTPUT_FOLDER": "output", "message_Original site": "Original site", "ANALYTICS": "UA-15910682-2", "BLOG_EMAIL": "", "message_Posts for year %s": "Posts for year %s", "message_old posts page %d": "old posts page %d", "BLOG_TITLE": "Corleonis", "message_Posted": "Posted", "GALLERY_PATH": "galleries", "CODE_COLOR_SCHEME": "default", "message_Read in English": "Read in English", "CACHE_FOLDER": "cache", "tags": [{"link": "/categories/scala.html", "name": "Scala"}, {"link": "/categories/akka.html", "name": "Akka"}], "tags?": true, "__file__": "conf.pyc", "translations": [], "CONTENT_FOOTER": "Contents &copy; 2013 <a href=\"mailto:\">Swind</a> - Powered by <a href=\"http://nikola.ralsina.com.ar\">Nikola</a>", "BASE_URL": "http://swind.code-life.info", "THEME": "mySite", "message_Also available in": "Also available in", "BLOG_URL": "http://swind.code-life.info", "date": "2012-06-08 12:18", "__name__": "conf", "message_Posts about %s": "Posts about %s", "message_Posts for {month} {year}": "Posts for {month} {year}", "message_More posts about": "More posts about", "ARCHIVE_PATH": "", "DATE_FORMAT": "%Y-%m-%d %H:%M", "TAG_PATH": "categories", "prev": "/posts/akka-2_0-note-1.json", "message_Newer posts": "Newer posts", "message_LANGUAGE": "English", "MATHJAX_CONFIG": "", "message_Archive": "Archive", "message_Source": "Source", "DISQUS_FORUM": "swindgithub", "INDEXES_TITLE": ""}