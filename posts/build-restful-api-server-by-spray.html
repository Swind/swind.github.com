<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>用 Spray 建立一個簡單的 RESTful API Server | Corleonis</title>
<link href="../assets/css/bitter.css" rel="stylesheet" type="text/css">
<link href="../assets/css/main.css" rel="stylesheet" type="text/css">
<link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="http://swind.code-life.info/posts/build-restful-api-server-by-spray.html">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    },
    displayAlign: 'left', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><meta name="author" content="Swind">
<meta property="og:site_name" content="Corleonis">
<meta property="og:title" content="用 Spray 建立一個簡單的 RESTful API Server">
<meta property="og:url" content="http://swind.code-life.info/posts/build-restful-api-server-by-spray.html">
<meta property="og:description" content="Spray
最初是想要建立一個提供查詢服務的 RESTful API Server，可以讓 Client 的應用程式透過 RESTful API 查詢一些資料。
但是看來看去，用 Play2、Jersey、RESTEasy 等都蠻麻煩的，而且還需要使用 Web container（像 Tomcat、Jetty 等）。
所以才找到這個 Spray，而且又是用 Scala 開發的，實在沒有理由不試試看">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2012-11-06T20:11:00+08:00">
<meta property="article:tag" content="Akka">
<meta property="article:tag" content="Scala">
</head>
<body>
    <section class="social"><ul>
<li><a href="../index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="../archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="../rss.xml" title="RSS"><i class="icon-rss"></i></a></li>
            <li><a href="https://github.com/Swind" title="My Github"><i class="icon-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
            
    <div class="post">
    
    <h1 class="p-name entry-title" itemprop="headline name">用 Spray 建立一個簡單的 RESTful API Server</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2012-11-06T20:11:00+08:00">2012-11-06 20:11</time>
            

            
          |  
        <a href="build-restful-api-server-by-spray.rst" id="sourcelink">Source</a>

            </div>
            
        <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/akka.html" rel="tag">Akka</a></li>
           <li><a class="tag p-category" href="../categories/scala.html" rel="tag">Scala</a></li>
        </ul>
</div>

        </div>
        <div class="body">
            <div>
<p><a class="reference external" href="http://spray.cc/">Spray</a></p>
<p>最初是想要建立一個提供查詢服務的 RESTful API Server，可以讓 Client 的應用程式透過 RESTful API 查詢一些資料。
但是看來看去，用 Play2、Jersey、RESTEasy 等都蠻麻煩的，而且還需要使用 Web container（像 Tomcat、Jetty 等）。
所以才找到這個 Spray，而且又是用 Scala 開發的，實在沒有理由不試試看阿。 XD</p>
<p>若你連到官網看會發現他分成很多模組，老實說我也沒有詳細研究每個模組的功能。
因為 <a class="reference external" href="http://spray.cc/documentation/spray-can/">spray-can</a> 的範例看起來最簡單並且也符合我的需求，所以就直接用他了。</p>
<p>想瞭解更詳細內容的可以參考 <a class="reference external" href="https://github.com/spray/spray/tree/release-1.0-M2/examples/spray-can/simple-http-server/">spray-can 範例文件</a> 與 <a class="reference external" href="http://blog.cloudfoundry.com/2012/05/11/running-standalone-web-applications-on-cloud-foundry/">Running Standalone Web Applications on Cloud Foundry</a></p>
<!-- TEASER_END -->
<div class="section" id="id1">
<h2>環境準備</h2>
<p><a class="reference external" href="https://github.com/spray/spray/tree/release-1.0-M2/examples/spray-can/">spray-can 的範例</a> 已經有建立好一個簡單的 HttpServer 了，
所以我們先將 Spray 從 Github 上 Clone 下來。</p>
<pre class="code bash"><a name="rest_code_38b3aa49badd4c9a998bdd06721c06a1-1"></a>git clone git://github.com/spray/spray.git
</pre>
<p>然後複製出 spray/examples/spray-can/simple-http-server。
接著在 simple-http-server 底下，建立 build.sbt 讓 SBT 去 include 所需要的 Library。</p>
<p>順便設定 <a class="reference external" href="https://github.com/twitter/sbt-package-dist">package-dist</a>  這個 sbt plugin 所需要的資料。
package-dist 可以協助我們將 Project 所需要的 Library 與程式本身全部打包成一個 zip 檔。
但是這個 plugin 只能使用在 sbt 0.11.x，目前我還沒有看到可以在 0.12.x 的版本。
如果你不想用的話可以拿掉 Start 到 End 中間的內容。</p>
<p>而最下面的</p>
<blockquote>
EclipseKeys.createSrc := EclipseCreateSrc.Default + EclipsCreateSrc.Resource</blockquote>
<p>則是針對 sbteclipse 做的設定，讓 plugin 在產生 eclipse project 的時候可以將 src/main/resources 也加入 source folder。</p>
<pre class="code scala"><a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-1"></a><span class="c1">//Start - For package-dist</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-2"></a><span class="k">import</span> <span class="nn">com.twitter.sbt._</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-3"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-4"></a><span class="n">seq</span><span class="o">(</span><span class="nc">PackageDist</span><span class="o">.</span><span class="n">newSettings</span><span class="k">:</span> <span class="k">_</span><span class="kt">*</span><span class="o">)</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-5"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-6"></a><span class="n">seq</span><span class="o">(</span><span class="nc">GitProject</span><span class="o">.</span><span class="n">gitSettings</span><span class="k">:</span> <span class="k">_</span><span class="kt">*</span><span class="o">)</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-7"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-8"></a><span class="n">packageDistZipName</span> <span class="o">:=</span> <span class="s">"DictionaryServer.zip"</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-9"></a><span class="c1">//End - For package-dist</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-10"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-11"></a><span class="n">organization</span> <span class="o">:=</span> <span class="s">"cc.spray"</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-12"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-13"></a><span class="n">name</span> <span class="o">:=</span> <span class="s">"DictionaryServer"</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-14"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-15"></a><span class="n">mainClass</span> <span class="n">in</span> <span class="o">(</span><span class="nc">Compile</span><span class="o">,</span> <span class="n">packageBin</span><span class="o">)</span> <span class="o">:=</span> <span class="nc">Some</span><span class="o">(</span><span class="s">"cc.spray.example.Main"</span><span class="o">)</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-16"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-17"></a><span class="n">version</span> <span class="o">:=</span> <span class="s">"0.1.0-SNAPSHOT"</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-18"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-19"></a><span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">"2.9.2"</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-20"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-21"></a><span class="n">resolvers</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-22"></a><span class="s">"Typesafe repo"</span> <span class="n">at</span> <span class="s">"http://repo.typesafe.com/typesafe/releases/"</span><span class="o">,</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-23"></a><span class="s">"spray repo"</span> <span class="n">at</span> <span class="s">"http://repo.spray.cc/"</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-24"></a><span class="o">)</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-25"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-26"></a><span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-27"></a>    <span class="s">"com.typesafe.akka"</span> <span class="o">%</span> <span class="s">"akka-actor"</span> <span class="o">%</span> <span class="s">"2.0.3"</span><span class="o">,</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-28"></a>    <span class="s">"cc.spray"</span> <span class="o">%</span> <span class="s">"spray-server"</span> <span class="o">%</span> <span class="s">"1.0-M2"</span><span class="o">,</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-29"></a>    <span class="s">"cc.spray"</span> <span class="o">%</span> <span class="s">"spray-can"</span> <span class="o">%</span> <span class="s">"1.0-M2"</span><span class="o">,</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-30"></a>    <span class="s">"org.slf4j"</span> <span class="o">%</span> <span class="s">"slf4j-api"</span> <span class="o">%</span> <span class="s">"1.6.6"</span><span class="o">,</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-31"></a>    <span class="s">"ch.qos.logback"</span> <span class="o">%</span> <span class="s">"logback-classic"</span> <span class="o">%</span> <span class="s">"1.0.7"</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-32"></a><span class="o">)</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-33"></a>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-34"></a><span class="c1">//sbteclipse setting</span>
<a name="rest_code_2f644c2506e34887a0b9e0767c39ef90-35"></a><span class="nc">EclipseKeys</span><span class="o">.</span><span class="n">createSrc</span> <span class="o">:=</span> <span class="nc">EclipseCreateSrc</span><span class="o">.</span><span class="nc">Default</span> <span class="o">+</span> <span class="nc">EclipseCreateSrc</span><span class="o">.</span><span class="nc">Resource</span>
</pre>
<p>這邊注意一下 Spray 的版本問題，現在最新的 Example 程式碼是針對最新版本的 spray，但他們還沒有正式 release，
並且他們還換了 package name 等，所以我都是使用 1.0-M2 的版本，當然 Library 也是使用 1.0-M2。</p>
<p>到這邊，我們的環境就準備的差不多了。接下來，只要執行範例程式碼就可以有一個可以提供 Web Service 的 Http Server 了。</p>
</div>
<div class="section" id="start-http-server">
<h2>Start Http Server</h2>
<p>如果你對於 Akka 的用法有一點概念的話，那麼 Spray 對你來說應該是非常好上手的。</p>
<p>Main.scala 啟動一個 IoWorker Actor 負責 low-level 的 network I/O，
接下來將 IoWorker Actor 以及 Service Actor 傳入 HttpServer Actor並啟動 Http Server。
之後透過發送一個 HttpServer.Bind 的 Message 給 Server 設定 IP 與 Port。
這樣就完成了 Server 的啟動與設定了。</p>
<pre class="code scala"><a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-1"></a><span class="c1">// we need an ActorSystem to host our application in</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-2"></a><span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">"SimpleHttpServer"</span><span class="o">)</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-3"></a>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-4"></a><span class="c1">// the handler actor replies to incoming HttpRequests</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-5"></a><span class="k">val</span> <span class="n">handler</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">Props</span><span class="o">[</span><span class="kt">TestService</span><span class="o">])</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-6"></a>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-7"></a><span class="c1">// every spray-can HttpServer (and HttpClient) needs an IoWorker for low-level network IO</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-8"></a><span class="c1">// (but several servers and/or clients can share one)</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-9"></a><span class="k">val</span> <span class="n">ioWorker</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IoWorker</span><span class="o">(</span><span class="n">system</span><span class="o">).</span><span class="n">start</span><span class="o">()</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-10"></a>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-11"></a><span class="c1">// create and start the spray-can HttpServer, telling it that we want requests to be</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-12"></a><span class="c1">// handled by our singleton handler</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-13"></a><span class="k">val</span> <span class="n">server</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-14"></a><span class="n">props</span> <span class="k">=</span> <span class="nc">Props</span><span class="o">(</span><span class="k">new</span> <span class="nc">HttpServer</span><span class="o">(</span><span class="n">ioWorker</span><span class="o">,</span> <span class="nc">MessageHandlerDispatch</span><span class="o">.</span><span class="nc">SingletonHandler</span><span class="o">(</span><span class="n">handler</span><span class="o">))),</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-15"></a><span class="n">name</span> <span class="k">=</span> <span class="s">"http-server"</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-16"></a><span class="o">)</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-17"></a>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-18"></a><span class="c1">// a running HttpServer can be bound, unbound and rebound</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-19"></a><span class="c1">// initially to need to tell it where to bind to</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-20"></a><span class="n">server</span> <span class="o">!</span> <span class="nc">HttpServer</span><span class="o">.</span><span class="nc">Bind</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">8080</span><span class="o">)</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-21"></a>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-22"></a><span class="c1">// finally we drop the main thread but hook the shutdown of</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-23"></a><span class="c1">// our IoWorker into the shutdown of the applications ActorSystem</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-24"></a><span class="n">system</span><span class="o">.</span><span class="n">registerOnTermination</span> <span class="o">{</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-25"></a><span class="n">ioWorker</span><span class="o">.</span><span class="n">stop</span><span class="o">()</span>
<a name="rest_code_9cb2cbdb04e440e4baa852e9ea56b522-26"></a><span class="o">}</span>
</pre>
</div>
<div class="section" id="service">
<h2>提供 Service</h2>
<div class="section" id="http-request">
<h3>處理 Http Request</h3>
<p>提供 Service 的 Actor 會接收到 HttpRequest 的 Message，HttpRequest 的內容如下。</p>
<pre class="code scala"><a name="rest_code_7b76b9342a734bd7bd9eeee1754c95eb-1"></a><span class="k">case</span> <span class="k">class</span> <span class="nc">HttpRequest</span><span class="o">(</span>
<a name="rest_code_7b76b9342a734bd7bd9eeee1754c95eb-2"></a>            <span class="n">method</span>   <span class="k">:</span> <span class="kt">HttpMethod</span> <span class="o">=</span> <span class="nc">HttpMethods</span><span class="o">.</span><span class="nc">GET</span><span class="o">,</span>
<a name="rest_code_7b76b9342a734bd7bd9eeee1754c95eb-3"></a>            <span class="n">uri</span>      <span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">,</span>
<a name="rest_code_7b76b9342a734bd7bd9eeee1754c95eb-4"></a>            <span class="n">headers</span>  <span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">HttpHeader</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Nil</span><span class="o">,</span>
<a name="rest_code_7b76b9342a734bd7bd9eeee1754c95eb-5"></a>            <span class="n">content</span>  <span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">HttpContent</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
<a name="rest_code_7b76b9342a734bd7bd9eeee1754c95eb-6"></a>            <span class="n">protocol</span> <span class="k">:</span> <span class="kt">HttpProtocol</span> <span class="o">=</span> <span class="n">`HTTP/1.1`</span><span class="o">)</span>
</pre>
<p>然後就可以利用 match 來處理各種不同的 HttpRequest，
例如有連線到 <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a> 的 GET 請求，
就會對應到第一個 HttpRequest "/"。</p>
<pre class="code scala"><a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-1"></a><span class="k">protected</span> <span class="k">def</span> <span class="n">receive</span> <span class="k">=</span> <span class="o">{</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-2"></a>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-3"></a>    <span class="k">case</span> <span class="nc">HttpRequest</span><span class="o">(</span><span class="nc">GET</span><span class="o">,</span> <span class="s">"/"</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-4"></a>        <span class="n">sender</span> <span class="o">!</span> <span class="n">index</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-5"></a>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-6"></a>    <span class="k">case</span> <span class="nc">HttpRequest</span><span class="o">(</span><span class="nc">GET</span><span class="o">,</span> <span class="s">"/ping"</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-7"></a>        <span class="n">sender</span> <span class="o">!</span> <span class="n">response</span><span class="o">(</span><span class="s">"PONG!"</span><span class="o">)</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-8"></a>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-9"></a>    <span class="k">case</span> <span class="nc">HttpRequest</span><span class="o">(</span><span class="nc">GET</span><span class="o">,</span> <span class="s">"/stats"</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-10"></a>        <span class="k">val</span> <span class="n">client</span> <span class="k">=</span> <span class="n">sender</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-11"></a>        <span class="n">context</span><span class="o">.</span><span class="n">actorFor</span><span class="o">(</span><span class="s">"../http-server"</span><span class="o">).</span><span class="n">ask</span><span class="o">(</span><span class="nc">HttpServer</span><span class="o">.</span><span class="nc">GetStats</span><span class="o">)(</span><span class="mf">1.</span><span class="n">second</span><span class="o">).</span><span class="n">onSuccess</span> <span class="o">{</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-12"></a>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-13"></a>    <span class="k">case</span> <span class="n">x</span><span class="k">:</span> <span class="kt">HttpServer.Stats</span> <span class="o">=&gt;</span> <span class="n">client</span> <span class="o">!</span> <span class="n">statsPresentation</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-14"></a>    <span class="o">}</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-15"></a><span class="o">.</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-16"></a><span class="o">.</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-17"></a><span class="o">.</span>
<a name="rest_code_cc8a3f1b2ddd48b895417a80105f7f4c-18"></a><span class="o">}</span>
</pre>
</div>
<div class="section" id="http-response">
<h3>建立 Http Response</h3>
<p>Response 的內容也非常好設定，以剛剛送回 sender 的 index 為例子，
Spray 使用一個 HttpResonse 的 case class 來代表 Response 的內容。
只要設定好 headers、body 與 status 就可以傳送回去 Sender 了。</p>
<pre class="code scala"><a name="rest_code_0d99d941cd154e5baf605209c205097c-1"></a><span class="k">lazy</span> <span class="k">val</span> <span class="n">index</span> <span class="k">=</span> <span class="nc">HttpResponse</span><span class="o">(</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-2"></a><span class="n">headers</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="nc">HttpHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/html"</span><span class="o">)),</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-3"></a><span class="n">body</span> <span class="k">=</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-4"></a>  <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-5"></a>    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-6"></a>      <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="nc">Say</span> <span class="n">hello</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">i</span><span class="o">&gt;</span><span class="n">spray</span><span class="o">-</span><span class="n">can</span><span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;!&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-7"></a>      <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="nc">Defined</span> <span class="n">resources</span><span class="o">:&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-8"></a>      <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-9"></a>        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"/ping"</span><span class="o">&gt;/</span><span class="n">ping</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-10"></a>        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"/search"</span><span class="o">&gt;/</span><span class="n">search</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-11"></a>        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"/stats"</span><span class="o">&gt;/</span><span class="n">stats</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-12"></a>        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"/crash"</span><span class="o">&gt;/</span><span class="n">crash</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-13"></a>        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"/timeout"</span><span class="o">&gt;/</span><span class="n">timeout</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-14"></a>        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"/timeout/timeout"</span><span class="o">&gt;/</span><span class="n">timeout</span><span class="o">/</span><span class="n">timeout</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-15"></a>        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"/stop"</span><span class="o">&gt;/</span><span class="n">stop</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-16"></a>      <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-17"></a>    <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-18"></a>  <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;.</span><span class="n">toString</span><span class="o">.</span><span class="n">getBytes</span><span class="o">(</span><span class="s">"ISO-8859-1"</span><span class="o">),</span>
<a name="rest_code_0d99d941cd154e5baf605209c205097c-19"></a><span class="n">status</span> <span class="k">=</span> <span class="mi">200</span><span class="o">)</span>
</pre>
</div>
</div>
</div>
        </div>
        
        <ul class="pager">
<li class="previous">
                <a href="akka-2_0-note-6.html" rel="prev" title="Akka 2.0 筆記(6) - Dispatcher 的設定">Previous post</a>
            </li>
            <li class="next">
                <a href="epubconverter-0_0_2.html" rel="next" title="EPUBConverter 0.0.2 - 其實已經重寫了 Orz">Next post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="swindgithub",
            disqus_url="http://swind.code-life.info/posts/build-restful-api-server-by-spray.html",
        disqus_title="\u7528 Spray \u5efa\u7acb\u4e00\u500b\u7c21\u55ae\u7684 RESTful API Server",
        disqus_identifier="cache/posts/2012-11-06-spray.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        

    </div>

        
       <script>var disqus_shortname="swindgithub";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer" role="contentinfo"><p>Contents © 2015 <a href="mailto:">Swind</a> - 
Powered by <a href="http://getnikola.com">Nikola</a> - 
Zen theme based in <a href="https://github.com/arusahni/website-template">Arusahni's website-template</a><br><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/ar/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="http://i.creativecommons.org/l/by-nc-sa/2.5/ar/88x31.png"></a></p>
            
        </footer>
</div>
    </section><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42855873-1', 'code-life.info');
  ga('send', 'pageview');

</script><script src="../assets/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="../assets/js/jquery.timeago.js" type="text/javascript"></script><!-- Social buttons --><div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
 <a class="addthis_button_more"><i class="icon-share-sign icon-2x"></i>    Share</a>
 <ul>
<li>
<a class="addthis_button_twitter"><i class="icon-twitter icon-2x"></i>    Twitter</a>
 </li>
<li>
<a class="addthis_button_google_plusone_share"><i class="icon-google-plus-sign icon-2x"></i>    Google+</a>
 </li>
<li>
<a class="addthis_button_linkedin"><i class="icon-linkedin icon-2x"></i>    Linkedin</a>
 </li>
<li>
<a class="addthis_button_facebook"><i class="icon-facebook-sign icon-2x"></i>    Facebook</a>
 </li>
</ul>
</div>
 <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script><!-- End of social buttons --><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
