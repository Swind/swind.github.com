{"THEME_REVEAL_CONGIF_TRANSITION": "cube", "message_Previous post": "Previous post", "LICENSE": "\n<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-sa/2.5/ar/\">\n<img alt=\"Creative Commons License BY-NC-SA\"\nstyle=\"border-width:0; margin-bottom:12px;\"\nsrc=\"http://i.creativecommons.org/l/by-nc-sa/2.5/ar/88x31.png\"></a>", "text": "<html><body><p>\u6703\u60f3\u5230\u7528\u9019\u500b\u662f\u7531\u65bc EPUBConverter Go \u7684\u7248\u672c\u96d6\u7136\u904b\u4f5c\u4e0a\u5df2\u7d93\u6bd4 Scala \u7248\u672c\u5feb\u4e0a\u4e0d\u5c11\u4e86\u3002\n\u4f46\u6211\u767c\u73fe\u5728\u57f7\u884c\u7684\u6642\u5019 CPU \u4f7f\u7528\u7387\u4e00\u76f4\u90fd\u53ea\u6709 25 %\uff0c\u6240\u4ee5\u624d\u60f3\u8a66\u8a66\u770b\u4f7f\u7528 goroutine \u770b\u80fd\u4e0d\u80fd\u8b93\u4ed6\u8f49\u63db\u66f4\u5feb\u4e00\u9ede\u3002</p>\n<p>\u4f9d\u7167\u6587\u4ef6\u6240\u8aaa\uff0c\u5728\u57f7\u884c IO \u76f8\u95dc\u52d5\u4f5c\u7684\u6642\u5019\uff0c\u6703\u5c07 CPU \u8b93\u7d66 goroutine \u4f86\u4f7f\u7528\uff0c\u90a3\u9ebc\u5c0d\u65bc EPUBConverter \u7684\u6548\u80fd\u61c9\u8a72\u6703\u6709\u986f\u8457\u7684\u63d0\u6607\u3002</p>\n<p>\u96d6\u7136\u6709\u4eba\u8aaa goroutine \u8ddf Scala \u7684 actor \u6709\u9ede\u50cf\uff0c\u4f46\u662f actor \u7684\u6a21\u578b\u5c31\u5f88\u5177\u9ad4\u8ddf\u660e\u78ba\u3002\n\u800c goroutine \u5247\u662f\u63d0\u4f9b\u4e00\u500b\u65b9\u4fbf\u5feb\u901f\u7684 thread \u64cd\u4f5c\u65b9\u5f0f\u3002</p>\n<!-- TEASER_END -->\n<div class=\"section\" id=\"goroutine\">\n<h2>goroutine \u7684\u4f7f\u7528\u65b9\u5f0f</h2>\n<p>goroutine \u7684\u4f7f\u7528\u975e\u5e38\u7c21\u55ae\uff0c\u53ea\u8981\u5728\u547c\u53eb function \u7684\u6642\u5019\u5728\u524d\u9762\u52a0\u4e0a go \u5c31\u53ef\u4ee5\u4e86\u3002</p>\n<blockquote>\ngo func()</blockquote>\n<p>\u81f3\u65bc\u8981\u8ddf goroutine \u7684\u6e9d\u901a\u5247\u662f\u4f7f\u7528 channel\u3002</p>\n<p>channel \u76ee\u524d\u6211\u4f7f\u7528\u7684\u611f\u89ba\u5f88\u50cf\u662f java \u4e2d\u7684 blocking queue\u3002\n\u4ed6\u7684\u5ba3\u544a\u65b9\u5f0f\u53ea\u8981\u5728\u4e00\u822c\u5ba3\u544a\u7684\u6642\u5019\u52a0\u500b <strong>chan</strong> \u7684\u95dc\u9375\u5b57\u5c31\u53ef\u4ee5\u4e86\u3002</p>\n<pre class=\"code go literal-block\">\n<span class=\"kd\">var</span> <span class=\"nx\">count</span> <span class=\"kd\">chan</span> <span class=\"kt\">int</span>\n</pre>\n<p>\u9019\u6a23\u5c31\u53ef\u4ee5\u900f\u904e &lt;- \u8ce6\u503c\u8207\u53d6\u503c</p>\n<pre class=\"code go literal-block\">\n<span class=\"c1\">//\u5c07 i assign \u7d66 count\n</span><span class=\"nx\">count</span> <span class=\"o\">&lt;-</span> <span class=\"nx\">i</span>\n<span class=\"c1\">//\u5f9e count \u53d6\u51fa\u503c\n</span><span class=\"nx\">value</span> <span class=\"o\">:=</span> <span class=\"o\">&lt;-</span> <span class=\"nx\">count</span>\n</pre>\n<p>\u800c\u8981\u6c7a\u5b9a channel \u53ef\u4ee5\u653e\u7684\u6578\u91cf\u5247\u662f\u53ef\u4ee5\u900f\u904e</p>\n<pre class=\"code go literal-block\">\n<span class=\"nx\">count</span> <span class=\"o\">:=</span> <span class=\"nb\">make</span><span class=\"p\">(</span><span class=\"kd\">chan</span> <span class=\"kt\">int</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">)</span>\n</pre>\n<p>\u7684\u65b9\u5f0f\u4f86\u6c7a\u5b9a\u3002</p>\n<p>\u4ee5\u4e0a\u9762\u7684\u7a0b\u5f0f\u78bc\u70ba\u4f8b\u5b50\uff0c\u7576 count \u88e1\u9762\u6c92\u6709\u6771\u897f\u6642\uff0c\u4f7f\u7528 &lt;- count \u6703 block \u4f4f\u76f4\u5230\u6709\u503c\u5beb\u5165\u3002\n\u800c\u4f7f\u7528 count &lt;- \u7684\u6642\u5019\u7576\u88e1\u9762\u7684\u503c\u8d85\u904e 4 \u500b\u7684\u6642\u5019\uff0c\u5247\u6703 block \u4f4f\u7121\u6cd5\u5beb\u5165\uff0c\u76f4\u5230\u6709\u503c\u88ab\u53d6\u51fa\u3002</p>\n</div>\n<div class=\"section\" id=\"id1\">\n<h2>goroutine \u7684\u8a2d\u5b9a</h2>\n<p>\u96d6\u7136\u5f8c\u4f86\u4f7f\u7528\u4e86 goroutine \u8b93\u6bcf\u4e00\u500b EPUB \u96fb\u5b50\u66f8\u7684\u8f49\u63db\u90fd\u53ef\u4ee5\u5e73\u884c\u8655\u7406\uff0c\n\u4f46\u662f\u6211\u767c\u73fe CPU \u4f7f\u7528\u7387\u537b\u4f9d\u7136\u53ea\u6709 25 %\u3002</p>\n<p>\u5f8c\u4f86\u624d\u767c\u73fe\u662f\u9084\u8981\u518d\u8a2d\u5b9a GOMAXPROCS \u4f86\u8b93 Go \u77e5\u9053\u8981\u7528\u5e7e\u500b\u6838\u5fc3\u3002</p>\n<pre class=\"code go literal-block\">\n<span class=\"c1\">//\u900f\u904e runtime.NumCPU() \u53d6\u5f97 CPU \u6838\u5fc3\u6578\n</span><span class=\"nx\">runtime</span><span class=\"p\">.</span><span class=\"nx\">GOMAXPROCS</span><span class=\"p\">(</span><span class=\"nx\">runtime</span><span class=\"p\">.</span><span class=\"nx\">NumCPU</span><span class=\"p\">())</span>\n</pre>\n<p>\u9019\u6a23\u5c31\u7d42\u65bc\u770b\u5f97\u5230 CPU \u4f7f\u7528\u7387\u5230 100% \u4e86 ...</p>\n</div>\n<div class=\"section\" id=\"golang-benchmark\">\n<h2>Golang \u7684 benchmark \u6e2c\u8a66</h2>\n<p><a class=\"reference external\" href=\"http://golang.org/pkg/testing/\">testing package</a></p>\n<p>Go \u53e6\u5916\u4e00\u9ede\u8b93\u6211\u9084\u883b\u559c\u6b61\u7684\u5c31\u662f\uff0c\u4ed6\u7684\u8a2d\u8a08\u975e\u5e38\u7684\u5be6\u7528\u3002\n\u96d6\u7136\u9084\u6c92\u6709\u5f88\u5b8c\u6574\uff0c\u4f46\u662f\u4e00\u822c\u958b\u767c\u5e38\u7528\u7684\u6771\u897f\u4ed6\u90fd\u6703\u5e6b\u4f60\u60f3\u5230\u3002\n\u4f8b\u5982\u5beb\u5728 test case \u5167\u7684 benchmark\u3002</p>\n<pre class=\"code go literal-block\">\n<span class=\"kn\">package</span> <span class=\"nx\">main</span>\n\n<span class=\"kn\">import</span> <span class=\"p\">(</span>\n        <span class=\"s\">\"runtime\"</span>\n        <span class=\"s\">\"testing\"</span>\n<span class=\"p\">)</span>\n\n<span class=\"kd\">func</span> <span class=\"nx\">BenchmarkConvertCore4</span><span class=\"p\">(</span><span class=\"nx\">b</span> <span class=\"o\">*</span><span class=\"nx\">testing</span><span class=\"p\">.</span><span class=\"nx\">B</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"c1\">// 4 \u4ee3\u8868\u4f7f\u7528\u7684\u6838\u5fc3\u6578\n</span>        <span class=\"nx\">executeConvert</span><span class=\"p\">(</span><span class=\"s\">\"./testdata\"</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</pre>\n<p>\u6e2c\u8a66\u7d50\u679c</p>\n<p>\u4f7f\u7528\u56db\u6838\u5fc3:</p>\n<pre class=\"literal-block\">\nBenchmarkConvertCore4          1        9775559100 ns/op\nok      epubconverter   10.282s\n</pre>\n<p>\u4f7f\u7528\u55ae\u6838:</p>\n<pre class=\"literal-block\">\nBenchmarkConvertCore1          1        33146895900 ns/op\nok      epubconverter   33.673s\n</pre>\n</div></body></html>", "ARCHIVE_FILENAME": "archive.html", "THEME_REVEAL_CONGIF_SUBTHEME": "sky", "message_Read more": "Read more", "SITE_URL": "http://swind.code-life.info", "LISTINGS_FOLDER": "listings", "INDEXES_PAGES": "", "next": "/posts/install-linux-config.json", "message_Next post": "Next post", "BLOG_DESCRIPTION": "I am Swind.", "EXTRA_HEAD_DATA": "", "DEFAULT_LANG": "en", "disqus_html": "<div id=\"disqus_thread\"></div> <script type=\"text/javascript\">var disqus_shortname=\"swindgithub\";var disqus_url=\"http://swind.code-life.info/posts/goroutine-note-1.html\";(function(){var a=document.createElement(\"script\");a.type=\"text/javascript\";a.async=true;a.src=\"http://\"+disqus_shortname+\".disqus.com/embed.js\";(document.getElementsByTagName(\"head\")[0]||document.getElementsByTagName(\"body\")[0]).appendChild(a)})();        </script><noscript>Please enable JavaScript to view the <a href=\"http://disqus.com/?ref_noscript\">comments powered by DISQUS.</a></noscript><a href=\"http://disqus.com\"class=\"dsq-brlink\">comments powered by <span class=\"logo-disqus\">DISQUS</span></a>", "RSS_PATH": "", "title": "Golang - Goroutine \u7b46\u8a18 (1)", "SEARCH_FORM": "", "message_Tags": "Tags", "INDEX_PATH": "", "BLOG_AUTHOR": "Swind", "message_Older posts": "Older posts", "OUTPUT_FOLDER": "output", "message_Original site": "Original site", "ANALYTICS": "UA-15910682-2", "BLOG_EMAIL": "", "message_Posts for year %s": "Posts for year %s", "message_old posts page %d": "old posts page %d", "BLOG_TITLE": "Corleonis", "message_Posted": "Posted", "GALLERY_PATH": "galleries", "CODE_COLOR_SCHEME": "default", "message_Read in English": "Read in English", "CACHE_FOLDER": "cache", "tags": [{"link": "/categories/go.html", "name": "Go"}], "tags?": true, "__file__": "conf.pyc", "translations": [], "CONTENT_FOOTER": "Contents &copy; 2013 <a href=\"mailto:\">Swind</a> - Powered by <a href=\"http://nikola.ralsina.com.ar\">Nikola</a>", "BASE_URL": "http://swind.code-life.info", "THEME": "mySite", "message_Also available in": "Also available in", "BLOG_URL": "http://swind.code-life.info", "date": "2012-12-09 18:00", "__name__": "conf", "message_Posts about %s": "Posts about %s", "message_Posts for {month} {year}": "Posts for {month} {year}", "message_More posts about": "More posts about", "ARCHIVE_PATH": "", "DATE_FORMAT": "%Y-%m-%d %H:%M", "TAG_PATH": "categories", "prev": "/posts/epubconverter-0_0_2.json", "message_Newer posts": "Newer posts", "message_LANGUAGE": "English", "MATHJAX_CONFIG": "", "message_Archive": "Archive", "message_Source": "Source", "DISQUS_FORUM": "swindgithub", "INDEXES_TITLE": ""}