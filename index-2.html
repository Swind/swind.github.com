<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Corleonis"><meta name="author" content="Swind"><title>Corleonis (old posts, page 2) | Corleonis</title><link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="assets/css/rst.css" rel="stylesheet" type="text/css"><link href="assets/css/code.css" rel="stylesheet" type="text/css"><link href="assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="assets/css/theme.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml"><link rel="stylesheet" type="text/css" href="assets/css/tipuesearch.css"></head><body><div id="tipue_search_content" style="margin-left: auto; margin-right: auto; padding: 20px;"></div>



<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://swind.code-life.info/">Corleonis</a>
    </div>
    <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav"><li><a href="archive.html">Archives</a>
                </li><li><a href="categories/index.html">Tags</a>
                </li><li><a href="rss.xml">RSS</a>

        </li></ul><span class="navbar-form pull-left">
<input type="text" id="tipue_search_input"></span>

        <ul class="nav navbar-nav navbar-right"></ul></div><!-- /.navbar-collapse -->
</nav><!-- End of Menubar --><div class="container">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
        <article class="postbox h-entry post-text"><h1 class="p-name"><a href="posts/build-restful-api-server-by-spray.html" class="u-url">用 Spray 建立一個簡單的 RESTful API Server</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2012-11-06T20:11:00+00:00">2012-11-06 20:11</time></small></h1>
        <hr><div class="p-summary">
        <div><p><a class="reference external" href="http://spray.cc/">Spray</a></p>
<p>最初是想要建立一個提供查詢服務的 RESTful API Server，可以讓 Client 的應用程式透過 RESTful API 查詢一些資料。
但是看來看去，用 Play2、Jersey、RESTEasy 等都蠻麻煩的，而且還需要使用 Web container（像 Tomcat、Jetty 等）。
所以才找到這個 Spray，而且又是用 Scala 開發的，實在沒有理由不試試看阿。 XD</p>
<p>若你連到官網看會發現他分成很多模組，老實說我也沒有詳細研究每個模組的功能。
因為 <a class="reference external" href="http://spray.cc/documentation/spray-can/">spray-can</a> 的範例看起來最簡單並且也符合我的需求，所以就直接用他了。</p>
<p>想瞭解更詳細內容的可以參考 <a class="reference external" href="https://github.com/spray/spray/tree/release-1.0-M2/examples/spray-can/simple-http-server/">spray-can 範例文件</a> 與 <a class="reference external" href="http://blog.cloudfoundry.com/2012/05/11/running-standalone-web-applications-on-cloud-foundry/">Running Standalone Web Applications on Cloud Foundry</a></p>
<p class="more"><a href="posts/build-restful-api-server-by-spray.html">Read more…</a></p></div>
        </div>
            
        
    <p>
        <a href="posts/build-restful-api-server-by-spray.html#disqus_thread" data-disqus-identifier="cache/posts/2012-11-06-spray.html">Comments</a>


        </p></article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="posts/akka-2_0-note-6.html" class="u-url">Akka 2.0 筆記(6) - Dispatcher 的設定</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2012-06-17T20:19:00+00:00">2012-06-17 20:19</time></small></h1>
        <hr><div class="p-summary">
        <div><p>今天早上先簡單了依照昨天畫得架構圖做了一個雛型，整個跑起來功能是以了，但是流程整個悲劇 Orz ...
先是 Exception Handling 做的不夠好，結果就真的是 "Let it Crash" 一直死一直死一直死，好像在玩 D3 的煉獄模式一樣。</p>
<p>再來是我沒有去設定 Dispatcher 所以 Thread 用了十幾個。如果我沒有看錯的話，依照 Akka <a class="reference external" href="https://github.com/akka/akka/blob/master/akka-actor/src/main/resources/reference.conf">reference.conf</a> 的設定，
Default Dispatcher 使用 fork-join-executor，他的預設設定如下</p>
<pre class="code scala literal-block">
<span class="n">fork</span><span class="o">-</span><span class="n">join</span><span class="o">-</span><span class="n">executor</span> <span class="o">{</span>
  <span class="k">#</span> <span class="nc">Min</span> <span class="n">number</span> <span class="n">of</span> <span class="n">threads</span> <span class="n">to</span> <span class="n">cap</span> <span class="n">factor</span><span class="o">-</span><span class="n">based</span> <span class="n">parallelism</span> <span class="n">number</span> <span class="n">to</span>
  <span class="n">parallelism</span><span class="o">-</span><span class="n">min</span> <span class="k">=</span> <span class="mi">8</span>

  <span class="k">#</span> <span class="nc">Parallelism</span> <span class="o">(</span><span class="n">threads</span><span class="o">)</span> <span class="o">...</span> <span class="n">ceil</span><span class="o">(</span><span class="n">available</span> <span class="n">processors</span> <span class="o">*</span> <span class="n">factor</span><span class="o">)</span>
  <span class="n">parallelism</span><span class="o">-</span><span class="n">factor</span> <span class="k">=</span> <span class="mf">3.0</span>

  <span class="k">#</span> <span class="nc">Max</span> <span class="n">number</span> <span class="n">of</span> <span class="n">threads</span> <span class="n">to</span> <span class="n">cap</span> <span class="n">factor</span><span class="o">-</span><span class="n">based</span> <span class="n">parallelism</span> <span class="n">number</span> <span class="n">to</span>
  <span class="n">parallelism</span><span class="o">-</span><span class="n">max</span> <span class="k">=</span> <span class="mi">64</span>
<span class="o">}</span>
</pre>
<p>很簡單的 parallelism-min 與 parallelism-max 的值代表著 Thread 的上下限，那麼 parallelism_factor 呢？</p>
<p>他同樣也是限制 Thread 的上限，上限的計算方式為</p>
<blockquote>
parallelism-factor * 你的處理器核心數</blockquote>
<p>所以我的四核心桌機使用這個 Dispatcher 最多會開到 12 個 Thread Orz ...</p>
<p class="more"><a href="posts/akka-2_0-note-6.html">Read more…</a></p></div>
        </div>
            
        
    <p>
        <a href="posts/akka-2_0-note-6.html#disqus_thread" data-disqus-identifier="cache/posts/2012-06-17-akka-note-6-my-aggregator.html">Comments</a>


        </p></article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="posts/akka-2_0-note-5.html" class="u-url">Akka 2.0 筆記(5) - Scatter Gather</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2012-06-15T08:58:00+00:00">2012-06-15 08:58</time></small></h1>
        <hr><div class="p-summary">
        <div><p>繼上次完全看不懂的 Dataflow 之後，我還是想要一個 Akka 的 Scatter Gather 實作方式，因此想試著自己實做看看。</p>
<p>下圖是 <a class="reference external" href="http://www.eaipatterns.com/">Enterprise Integration Patterns</a>  書中的 Scatter-Gather 概念圖。</p>
<img alt="http://www.eaipatterns.com/img/BroadcastAggregate.gif" src="http://www.eaipatterns.com/img/BroadcastAggregate.gif"><p>從圖中可以發現，中間對於 Vendor A、B 與 C 進行 Broadcast 的行為跟 Akka 內的 <a class="reference external" href="http://doc.akka.io/docs/akka/2.0/scala/routing.html">Router</a> 很像，
所以當我正在思考 Router 是否合適作為這種用途的時候，我想到了 <a class="reference external" href="http://letitcrash.com/">Let it Crash</a> 裡面 <a class="reference external" href="http://letitcrash.com/post/23532935686/watch-the-routees">Watch the Routees</a> 這篇文章。</p>
<p>這篇文章裡面他紀錄了在 Akka mailinglist 中回答別人問題時所寫的範例程式。</p>
<p>整個 use case 是要執行一個 Job，這個 Job 由許多 Tasks 組成，在執行的過程中</p>
<ol class="arabic simple"><li>會將這些 Tasks 透過 router 分派給 worker actors 執行。</li>
<li>最後收集所有 worker 的執行結果，並且將他們合併之後回傳。</li>
<li>除此之外， worker 在執行過程中發生錯誤時，應該要進行 retry，在進行幾次 retry 後依然有錯誤時，Worker 就會停止，並且中止整個 Job。</li>
</ol><p class="more"><a href="posts/akka-2_0-note-5.html">Read more…</a></p></div>
        </div>
            
        
    <p>
        <a href="posts/akka-2_0-note-5.html#disqus_thread" data-disqus-identifier="cache/posts/2012-06-15-akka-note-5-aggregator.html">Comments</a>


        </p></article><div>
        <ul class="pager"><li class="previous">
                <a href="index.html" rel="prev">← Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1.html" rel="next">Older posts →</a>
            </li>
        </ul></div>

    
        
       <script>var disqus_shortname="swindgithub";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script></div>
        <!--End of body content-->

        <footer>
            Contents © 2014         <a href="mailto:">Swind</a> - Powered by         <a href="http://getnikola.com">Nikola</a>         
        </footer></div>
</div>


            <script src="assets/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="assets/js/bootstrap.min.js" type="text/javascript"></script><script src="assets/js/jquery.colorbox-min.js" type="text/javascript"></script><script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><script type="text/javascript" src="assets/js/tipuesearch_set.js"></script><script type="text/javascript" src="assets/js/tipuesearch.js"></script><script type="text/javascript">
$(document).ready(function() {
    $('#tipue_search_input').tipuesearch({
        'mode': 'json',
        'contentLocation': '/assets/js/tipuesearch_content.json',
        'showUrl': false
    });
});
</script></body></html>